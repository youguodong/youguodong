<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Vuex çŠ¶æ€ç®¡ç†çš„å·¥ä½œåŽŸç†]]></title>
    <url>%2F2018%2F10%2F25%2FVuex%20%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[Vuex çŠ¶æ€ç®¡ç†çš„å·¥ä½œåŽŸç†ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Vuexå½“æˆ‘ä»¬ä½¿ç”¨ Vue.js æ¥å¼€å‘ä¸€ä¸ªå•é¡µåº”ç”¨æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€äº›ç»„ä»¶é—´å…±äº«çš„æ•°æ®æˆ–çŠ¶æ€ï¼Œæˆ–æ˜¯éœ€è¦é€šè¿‡ props æ·±å±‚ä¼ é€’çš„ä¸€äº›æ•°æ®ã€‚åœ¨åº”ç”¨è§„æ¨¡è¾ƒå°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ propsã€äº‹ä»¶ç­‰å¸¸ç”¨çš„çˆ¶å­ç»„ä»¶çš„ç»„ä»¶é—´é€šä¿¡æ–¹æ³•ï¼Œæˆ–è€…æ˜¯é€šè¿‡äº‹ä»¶æ€»çº¿æ¥è¿›è¡Œä»»æ„ä¸¤ä¸ªç»„ä»¶çš„é€šä¿¡ã€‚ä½†æ˜¯å½“åº”ç”¨é€æ¸å¤æ‚åŽï¼Œé—®é¢˜å°±å¼€å§‹å‡ºçŽ°äº†ï¼Œè¿™æ ·çš„é€šä¿¡æ–¹å¼ä¼šå¯¼è‡´æ•°æ®æµå¼‚å¸¸åœ°æ··ä¹±ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æˆ‘ä»¬çš„çŠ¶æ€ç®¡ç†å·¥å…· Vuex äº†ã€‚Vuex æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º Vue.js æ¡†æž¶è®¾è®¡çš„ã€ä¸“é—¨ç”¨æ¥å¯¹äºŽ Vue.js åº”ç”¨è¿›è¡ŒçŠ¶æ€ç®¡ç†çš„åº“ã€‚å®ƒå€Ÿé‰´äº† Fluxã€redux çš„åŸºæœ¬æ€æƒ³ï¼Œå°†çŠ¶æ€æŠ½ç¦»åˆ°å…¨å±€ï¼Œå½¢æˆä¸€ä¸ª Storeã€‚å› ä¸º Vuex å†…éƒ¨é‡‡ç”¨äº† new Vue æ¥å°† Store å†…çš„æ•°æ®è¿›è¡Œã€Œå“åº”å¼åŒ–ã€ï¼Œæ‰€ä»¥ Vuex æ˜¯ä¸€æ¬¾åˆ©ç”¨ Vue å†…éƒ¨æœºåˆ¶çš„åº“ï¼Œä¸Ž Vue é«˜åº¦å¥‘åˆï¼Œä¸Ž Vue æ­é…ä½¿ç”¨æ˜¾å¾—æ›´åŠ ç®€å•é«˜æ•ˆï¼Œä½†ç¼ºç‚¹æ˜¯ä¸èƒ½ä¸Žå…¶ä»–çš„æ¡†æž¶ï¼ˆå¦‚ reactï¼‰é…åˆä½¿ç”¨ã€‚ æœ¬èŠ‚å°†ç®€å•ä»‹ç» Vuex æœ€æ ¸å¿ƒçš„å†…éƒ¨æœºåˆ¶ï¼Œèµ·ä¸ªæŠ›ç –å¼•çŽ‰çš„ä½œç”¨ï¼Œæƒ³äº†è§£æ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒç¬”è€… Github ä¸Šçš„å¦ä¸€ç¯‡æ–‡ç«  ã€ŠVuexæºç è§£æžã€‹æˆ–è€…ç›´æŽ¥é˜…è¯» Vuexæºç ã€‚ å®‰è£…Vue.js æä¾›äº†ä¸€ä¸ª Vue.use çš„æ–¹æ³•æ¥å®‰è£…æ’ä»¶ï¼Œå†…éƒ¨ä¼šè°ƒç”¨æ’ä»¶æä¾›çš„ install æ–¹æ³•ã€‚ 1Vue.use(Vuex); æ‰€ä»¥æˆ‘ä»¬çš„æ’ä»¶éœ€è¦æä¾›ä¸€ä¸ª install æ–¹æ³•æ¥å®‰è£…ã€‚ 123456let Vue;export default install (_Vue) &#123; Vue.mixin(&#123; beforeCreate: vuexInit &#125;); Vue = _Vue;&#125; æˆ‘ä»¬é‡‡ç”¨ Vue.mixin æ–¹æ³•å°† vuexInit æ–¹æ³•æ··æ·†è¿› beforeCreate é’©å­ä¸­ï¼Œå¹¶ç”¨ Vue ä¿å­˜ Vue å¯¹è±¡ã€‚é‚£ä¹ˆ vuexInit ç©¶ç«Ÿå®žçŽ°äº†ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨ Vuex çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°† store ä¼ å…¥åˆ° Vue å®žä¾‹ä¸­åŽ»ã€‚ 12345/*å°†storeæ”¾å…¥Vueåˆ›å»ºæ—¶çš„optionä¸­*/new Vue(&#123; el: &apos;#app&apos;, store&#125;); ä½†æ˜¯æˆ‘ä»¬å´åœ¨æ¯ä¸€ä¸ª vm ä¸­éƒ½å¯ä»¥è®¿é—®è¯¥ storeï¼Œè¿™ä¸ªå°±éœ€è¦é  vuexInit äº†ã€‚ 12345678function vuexInit () &#123; const options = this.$options; if (options.store) &#123; this.$store = options.store; &#125; else &#123; this.$store = options.parent.$store; &#125;&#125; å› ä¸ºä¹‹å‰å·²ç»ç”¨Vue.mixin æ–¹æ³•å°† vuexInit æ–¹æ³•æ··æ·†è¿› beforeCreate é’©å­ä¸­ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª vm å®žä¾‹éƒ½ä¼šè°ƒç”¨ vuexInit æ–¹æ³•ã€‚ å¦‚æžœæ˜¯æ ¹èŠ‚ç‚¹ï¼ˆ$optionsä¸­å­˜åœ¨ store è¯´æ˜Žæ˜¯æ ¹èŠ‚ç‚¹ï¼‰ï¼Œåˆ™ç›´æŽ¥å°† options.store èµ‹å€¼ç»™ this.$storeã€‚å¦åˆ™åˆ™è¯´æ˜Žä¸æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä»Žçˆ¶èŠ‚ç‚¹çš„ $store ä¸­èŽ·å–ã€‚ é€šè¿‡è¿™æ­¥çš„æ“ä½œï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ª vm ä¸­é€šè¿‡ this.$store æ¥è®¿é—® Store çš„å®žä¾‹å•¦ï½ž Storeæ•°æ®çš„å“åº”å¼åŒ–é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ Store çš„æž„é€ å‡½æ•°ä¸­å¯¹ state è¿›è¡Œã€Œå“åº”å¼åŒ–ã€ã€‚ 1234567constructor () &#123; this._vm = new Vue(&#123; data: &#123; $$state: this.state &#125; &#125;)&#125; ç†Ÿæ‚‰ã€Œå“åº”å¼ã€çš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œè¿™ä¸ªæ­¥éª¤ä»¥åŽï¼Œstate ä¼šå°†éœ€è¦çš„ä¾èµ–æ”¶é›†åœ¨ Dep ä¸­ï¼Œåœ¨è¢«ä¿®æ”¹æ—¶æ›´æ–°å¯¹åº”è§†å›¾ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ã€‚ 12345678910111213141516171819let globalData = &#123; d: &apos;hello world&apos;&#125;;new Vue(&#123; data () &#123; return &#123; $$state: &#123; globalData &#125; &#125; &#125;&#125;);/* modify */setTimeout(() =&gt; &#123; globalData.d = &apos;hi~&apos;;&#125;, 1000);Vue.prototype.globalData = globalData; ä»»æ„æ¨¡æ¿ä¸­ 1&lt;div&gt;&#123;&#123;globalData.d&#125;&#125;&lt;/div&gt; ä¸Šè¿°ä»£ç åœ¨å…¨å±€æœ‰ä¸€ä¸ª globalDataï¼Œå®ƒè¢«ä¼ å…¥ä¸€ä¸ª Vue å¯¹è±¡çš„ data ä¸­ï¼Œä¹‹åŽåœ¨ä»»æ„ Vue æ¨¡æ¿ä¸­å¯¹è¯¥å˜é‡è¿›è¡Œå±•ç¤ºï¼Œå› ä¸ºæ­¤æ—¶ globalData å·²ç»åœ¨ Vue çš„ prototype ä¸Šäº†æ‰€ä»¥ç›´æŽ¥é€šè¿‡ this.prototype è®¿é—®ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¨¡æ¿ä¸­çš„ ã€‚æ­¤æ—¶ï¼ŒsetTimeout åœ¨ 1s ä¹‹åŽå°† globalData.d è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬å‘çŽ°æ¨¡æ¿ä¸­çš„ globalData.d å‘ç”Ÿäº†å˜åŒ–ã€‚å…¶å®žä¸Šè¿°éƒ¨åˆ†å°±æ˜¯ Vuex ä¾èµ– Vue æ ¸å¿ƒå®žçŽ°æ•°æ®çš„â€œå“åº”å¼åŒ–â€ã€‚ è®²å®Œäº† Vuex æœ€æ ¸å¿ƒçš„é€šè¿‡ Vue è¿›è¡Œæ•°æ®çš„ã€Œå“åº”å¼åŒ–ã€ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥ä»‹ç»ä¸¤ä¸ª Store çš„ APIã€‚ commité¦–å…ˆæ˜¯ commit æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ commit æ–¹æ³•æ˜¯ç”¨æ¥è§¦å‘ mutation çš„ã€‚ 123456commit (type, payload, _options) &#123; const entry = this._mutations[type]; entry.forEach(function commitIterator (handler) &#123; handler(payload); &#125;);&#125; ä»Ž _mutations ä¸­å–å‡ºå¯¹åº”çš„ mutationï¼Œå¾ªçŽ¯æ‰§è¡Œå…¶ä¸­çš„æ¯ä¸€ä¸ª mutationã€‚ dispatchdispatch åŒæ ·é“ç†ï¼Œç”¨äºŽè§¦å‘ actionï¼Œå¯ä»¥åŒ…å«å¼‚æ­¥çŠ¶æ€ã€‚ 1234567dispatch (type, payload) &#123; const entry = this._actions[type]; return entry.length &gt; 1 ? Promise.all(entry.map(handler =&gt; handler(payload))) : entry[0](payload);&#125; åŒæ ·çš„ï¼Œå–å‡º _actions ä¸­çš„æ‰€æœ‰å¯¹åº” actionï¼Œå°†å…¶æ‰§è¡Œï¼Œå¦‚æžœæœ‰å¤šä¸ªåˆ™ç”¨ Promise.all è¿›è¡ŒåŒ…è£…ã€‚ æœ€åŽç†è§£ Vuex çš„æ ¸å¿ƒåœ¨äºŽç†è§£å…¶å¦‚ä½•ä¸Ž Vue æœ¬èº«ç»“åˆï¼Œå¦‚ä½•åˆ©ç”¨ Vue çš„å“åº”å¼æœºåˆ¶æ¥å®žçŽ°æ ¸å¿ƒ Store çš„ã€Œå“åº”å¼åŒ–ã€ã€‚ Vuex æœ¬èº«ä»£ç ä¸å¤šä¸”è®¾è®¡ä¼˜é›…ï¼Œéžå¸¸å€¼å¾—ä¸€è¯»ï¼Œæƒ³é˜…è¯»æºç çš„åŒå­¦è¯·çœ‹Vuexæºç ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€ŠVuexçŠ¶æ€ç®¡ç†çš„å·¥ä½œåŽŸç†ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Vue.js è¿è¡Œæœºåˆ¶å…¨å±€æ¦‚è§ˆ]]></title>
    <url>%2F2018%2F10%2F14%2FVue.js%20%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E5%85%A8%E5%B1%80%E6%A6%82%E8%A7%88%2F</url>
    <content type="text"><![CDATA[å…¨å±€æ¦‚è§ˆè¿™ä¸€èŠ‚ç¬”è€…å°†ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹ Vue.js å†…éƒ¨çš„æ•´ä¸ªæµç¨‹ï¼Œå¸Œæœ›èƒ½è®©å¤§å®¶å¯¹å…¨å±€æœ‰ä¸€ä¸ªæ•´ä½“çš„å°è±¡ï¼Œç„¶åŽæˆ‘ä»¬å†æ¥é€ä¸ªæ¨¡å—è¿›è¡Œè®²è§£ã€‚ä»Žæ¥æ²¡æœ‰äº†è§£è¿‡ Vue.js å®žçŽ°çš„åŒå­¦å¯èƒ½ä¼šå¯¹ä¸€äº›å†…å®¹æ„Ÿåˆ°ç–‘æƒ‘ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œè¿™ä¸€èŠ‚çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†è®©å¤§å®¶å¯¹æ•´ä¸ªæµç¨‹æœ‰ä¸€ä¸ªå¤§æ¦‚çš„è®¤è¯†ï¼Œç®—æ˜¯ä¸€ä¸ªæ¦‚è§ˆé¢„å¤‡çš„è¿‡ç¨‹ï¼Œå½“æŠŠæ•´æœ¬å°å†Œè®¤çœŸè¯»å®Œä»¥åŽï¼Œå†æ¥é˜…è¯»è¿™ä¸€èŠ‚ï¼Œç›¸ä¿¡ä¼šæœ‰æ”¶èŽ·çš„ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¬”è€…ç”»çš„å†…éƒ¨æµç¨‹å›¾ã€‚ å¤§å®¶ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªå›¾ä¸€å®šæ˜¯ä¸€å¤´é›¾æ°´çš„ï¼Œæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬æ¥é€ä¸ªè®²ä¸€ä¸‹è¿™äº›æ¨¡å—çš„ä½œç”¨ä»¥åŠè°ƒç”¨å…³ç³»ã€‚ç›¸ä¿¡è®²å®Œä¹‹åŽå¤§å®¶å¯¹Vue.jså†…éƒ¨è¿è¡Œæœºåˆ¶ä¼šæœ‰ä¸€ä¸ªå¤§æ¦‚çš„è®¤è¯†ã€‚ åˆå§‹åŒ–åŠæŒ‚è½½ åœ¨ new Vue() ä¹‹åŽã€‚ Vue ä¼šè°ƒç”¨ _init å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ init è¿‡ç¨‹ï¼Œå®ƒä¼šåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€ propsã€ methodsã€ dataã€ computed ä¸Ž watch ç­‰ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯é€šè¿‡ Object.defineProperty è®¾ç½® setter ä¸Ž getter å‡½æ•°ï¼Œç”¨æ¥å®žçŽ°ã€Œå“åº”å¼ã€ä»¥åŠã€Œä¾èµ–æ”¶é›†ã€ï¼ŒåŽé¢ä¼šè¯¦ç»†è®²åˆ°ï¼Œè¿™é‡Œåªè¦æœ‰ä¸€ä¸ªå°è±¡å³å¯ã€‚ åˆå§‹åŒ–ä¹‹åŽè°ƒç”¨ $mount ä¼šæŒ‚è½½ç»„ä»¶ï¼Œå¦‚æžœæ˜¯è¿è¡Œæ—¶ç¼–è¯‘ï¼Œå³ä¸å­˜åœ¨ render function ä½†æ˜¯å­˜åœ¨ template çš„æƒ…å†µï¼Œéœ€è¦è¿›è¡Œã€Œç¼–è¯‘ã€æ­¥éª¤ã€‚ ç¼–è¯‘compileç¼–è¯‘å¯ä»¥åˆ†æˆ parseã€optimize ä¸Ž generate ä¸‰ä¸ªé˜¶æ®µï¼Œæœ€ç»ˆéœ€è¦å¾—åˆ° render functionã€‚ parseparse ä¼šç”¨æ­£åˆ™ç­‰æ–¹å¼è§£æž template æ¨¡æ¿ä¸­çš„æŒ‡ä»¤ã€classã€styleç­‰æ•°æ®ï¼Œå½¢æˆASTã€‚ optimizeoptimize çš„ä¸»è¦ä½œç”¨æ˜¯æ ‡è®° static é™æ€èŠ‚ç‚¹ï¼Œè¿™æ˜¯ Vue åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸€å¤„ä¼˜åŒ–ï¼ŒåŽé¢å½“ update æ›´æ–°ç•Œé¢æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª patch çš„è¿‡ç¨‹ï¼Œ diff ç®—æ³•ä¼šç›´æŽ¥è·³è¿‡é™æ€èŠ‚ç‚¹ï¼Œä»Žè€Œå‡å°‘äº†æ¯”è¾ƒçš„è¿‡ç¨‹ï¼Œä¼˜åŒ–äº† patch çš„æ€§èƒ½ã€‚ generategenerate æ˜¯å°† AST è½¬åŒ–æˆ render function å­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œå¾—åˆ°ç»“æžœæ˜¯ render çš„å­—ç¬¦ä¸²ä»¥åŠ staticRenderFns å­—ç¬¦ä¸²ã€‚ åœ¨ç»åŽ†è¿‡ parseã€optimize ä¸Ž generate è¿™ä¸‰ä¸ªé˜¶æ®µä»¥åŽï¼Œç»„ä»¶ä¸­å°±ä¼šå­˜åœ¨æ¸²æŸ“ VNode æ‰€éœ€çš„ render function äº†ã€‚ å“åº”å¼æŽ¥ä¸‹æ¥ä¹Ÿå°±æ˜¯ Vue.js å“åº”å¼æ ¸å¿ƒéƒ¨åˆ†ã€‚ è¿™é‡Œçš„ getter è·Ÿ setter å·²ç»åœ¨ä¹‹å‰ä»‹ç»è¿‡äº†ï¼Œåœ¨ init çš„æ—¶å€™é€šè¿‡ Object.defineProperty è¿›è¡Œäº†ç»‘å®šï¼Œå®ƒä½¿å¾—å½“è¢«è®¾ç½®çš„å¯¹è±¡è¢«è¯»å–çš„æ—¶å€™ä¼šæ‰§è¡Œ getter å‡½æ•°ï¼Œè€Œåœ¨å½“è¢«èµ‹å€¼çš„æ—¶å€™ä¼šæ‰§è¡Œ setter å‡½æ•°ã€‚ å½“ render function è¢«æ¸²æŸ“çš„æ—¶å€™ï¼Œå› ä¸ºä¼šè¯»å–æ‰€éœ€å¯¹è±¡çš„å€¼ï¼Œæ‰€ä»¥ä¼šè§¦å‘ getter å‡½æ•°è¿›è¡Œã€Œä¾èµ–æ”¶é›†ã€ï¼Œã€Œä¾èµ–æ”¶é›†ã€çš„ç›®çš„æ˜¯å°†è§‚å¯Ÿè€… Watcher å¯¹è±¡å­˜æ”¾åˆ°å½“å‰é—­åŒ…ä¸­çš„è®¢é˜…è€… Dep çš„ subs ä¸­ã€‚å½¢æˆå¦‚ä¸‹æ‰€ç¤ºçš„è¿™æ ·ä¸€ä¸ªå…³ç³»ã€‚ åœ¨ä¿®æ”¹å¯¹è±¡çš„å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„ setterï¼Œ setter é€šçŸ¥ä¹‹å‰ã€Œä¾èµ–æ”¶é›†ã€å¾—åˆ°çš„ Dep ä¸­çš„æ¯ä¸€ä¸ª Watcherï¼Œå‘Šè¯‰å®ƒä»¬è‡ªå·±çš„å€¼æ”¹å˜äº†ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“è§†å›¾ã€‚è¿™æ—¶å€™è¿™äº› Watcher å°±ä¼šå¼€å§‹è°ƒç”¨ update æ¥æ›´æ–°è§†å›¾ï¼Œå½“ç„¶è¿™ä¸­é—´è¿˜æœ‰ä¸€ä¸ª patch çš„è¿‡ç¨‹ä»¥åŠä½¿ç”¨é˜Ÿåˆ—æ¥å¼‚æ­¥æ›´æ–°çš„ç­–ç•¥ï¼Œè¿™ä¸ªæˆ‘ä»¬åŽé¢å†è®²ã€‚ Virtual DOMæˆ‘ä»¬çŸ¥é“ï¼Œrender function ä¼šè¢«è½¬åŒ–æˆ VNode èŠ‚ç‚¹ã€‚Virtual DOM å…¶å®žå°±æ˜¯ä¸€æ£µä»¥ JavaScript å¯¹è±¡ï¼ˆ VNode èŠ‚ç‚¹ï¼‰ä½œä¸ºåŸºç¡€çš„æ ‘ï¼Œç”¨å¯¹è±¡å±žæ€§æ¥æè¿°èŠ‚ç‚¹ï¼Œå®žé™…ä¸Šå®ƒåªæ˜¯ä¸€å±‚å¯¹çœŸå®ž DOM çš„æŠ½è±¡ã€‚æœ€ç»ˆå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—æ“ä½œä½¿è¿™æ£µæ ‘æ˜ å°„åˆ°çœŸå®žçŽ¯å¢ƒä¸Šã€‚ç”±äºŽ Virtual DOM æ˜¯ä»¥ JavaScript å¯¹è±¡ä¸ºåŸºç¡€è€Œä¸ä¾èµ–çœŸå®žå¹³å°çŽ¯å¢ƒï¼Œæ‰€ä»¥ä½¿å®ƒå…·æœ‰äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨å¹³å°ã€Weexã€Node ç­‰ã€‚ æ¯”å¦‚è¯´ä¸‹é¢è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š 123456789&#123; tag: &apos;div&apos;, /*è¯´æ˜Žè¿™æ˜¯ä¸€ä¸ªdivæ ‡ç­¾*/ children: [ /*å­˜æ”¾è¯¥æ ‡ç­¾çš„å­èŠ‚ç‚¹*/ &#123; tag: &apos;a&apos;, /*è¯´æ˜Žè¿™æ˜¯ä¸€ä¸ªaæ ‡ç­¾*/ text: &apos;click me&apos; /*æ ‡ç­¾çš„å†…å®¹*/ &#125; ]&#125; æ¸²æŸ“åŽå¯ä»¥å¾—åˆ° 123&lt;div&gt; &lt;a&gt;click me&lt;/a&gt;&lt;/div&gt; è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®žé™…ä¸Šçš„èŠ‚ç‚¹æœ‰æ›´å¤šçš„å±žæ€§æ¥æ ‡å¿—èŠ‚ç‚¹ï¼Œæ¯”å¦‚ isStatic ï¼ˆä»£è¡¨æ˜¯å¦ä¸ºé™æ€èŠ‚ç‚¹ï¼‰ã€ isComment ï¼ˆä»£è¡¨æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹ï¼‰ç­‰ã€‚ æ›´æ–°è§†å›¾ å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œåœ¨ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡å€¼çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ setter -&gt; Watcher -&gt; update çš„æµç¨‹æ¥ä¿®æ”¹å¯¹åº”çš„è§†å›¾ï¼Œé‚£ä¹ˆæœ€ç»ˆæ˜¯å¦‚ä½•æ›´æ–°è§†å›¾çš„å‘¢ï¼Ÿ å½“æ•°æ®å˜åŒ–åŽï¼Œæ‰§è¡Œ render function å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–°çš„ VNode èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¦‚æžœæƒ³è¦å¾—åˆ°æ–°çš„è§†å›¾ï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹æ³•å°±æ˜¯ç›´æŽ¥è§£æžè¿™ä¸ªæ–°çš„ VNode èŠ‚ç‚¹ï¼Œç„¶åŽç”¨ innerHTML ç›´æŽ¥å…¨éƒ¨æ¸²æŸ“åˆ°çœŸå®ž DOM ä¸­ã€‚ä½†æ˜¯å…¶å®žæˆ‘ä»¬åªå¯¹å…¶ä¸­çš„ä¸€å°å—å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™æ ·åšä¼¼ä¹Žæœ‰äº›ã€Œæµªè´¹ã€ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸èƒ½åªä¿®æ”¹é‚£äº›ã€Œæ”¹å˜äº†çš„åœ°æ–¹ã€å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦ä»‹ç»æˆ‘ä»¬çš„ã€Œpatchã€äº†ã€‚æˆ‘ä»¬ä¼šå°†æ–°çš„ VNode ä¸Žæ—§çš„ VNode ä¸€èµ·ä¼ å…¥ patch è¿›è¡Œæ¯”è¾ƒï¼Œç»è¿‡ diff ç®—æ³•å¾—å‡ºå®ƒä»¬çš„ã€Œå·®å¼‚ã€ã€‚æœ€åŽæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›ã€Œå·®å¼‚ã€çš„å¯¹åº” DOM è¿›è¡Œä¿®æ”¹å³å¯ã€‚ å†çœ‹å…¨å±€ å›žè¿‡å¤´å†æ¥çœ‹çœ‹è¿™å¼ å›¾ï¼Œæ˜¯ä¸æ˜¯å¤§è„‘ä¸­å·²ç»æœ‰ä¸€ä¸ªå¤§æ¦‚çš„è„‰ç»œäº†å‘¢ï¼Ÿ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ç»§ç»­å­¦ä¹ æ¯ä¸€ä¸ªæ¨¡å—å§!]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[template æ¨¡æ¿æ˜¯æ€Žæ ·é€šè¿‡ Compile ç¼–è¯‘çš„]]></title>
    <url>%2F2018%2F10%2F11%2Ftemplate%20%E6%A8%A1%E6%9D%BF%E6%98%AF%E6%80%8E%E6%A0%B7%E9%80%9A%E8%BF%87%20Compile%20%E7%BC%96%E8%AF%91%E7%9A%84%2F</url>
    <content type="text"><![CDATA[Compilecompile ç¼–è¯‘å¯ä»¥åˆ†æˆ parseã€optimize ä¸Ž generate ä¸‰ä¸ªé˜¶æ®µï¼Œæœ€ç»ˆéœ€è¦å¾—åˆ° render functionã€‚è¿™éƒ¨åˆ†å†…å®¹ä¸ç®— Vue.js çš„å“åº”å¼æ ¸å¿ƒï¼Œåªæ˜¯ç”¨æ¥ç¼–è¯‘çš„ï¼Œç¬”è€…è®¤ä¸ºåœ¨ç²¾åŠ›æœ‰é™çš„æƒ…å†µä¸‹ä¸éœ€è¦è¿½ç©¶å…¶å…¨éƒ¨çš„å®žçŽ°ç»†èŠ‚ï¼Œèƒ½å¤ŸæŠŠæ¡å¦‚ä½•è§£æžçš„å¤§è‡´æµç¨‹å³å¯ã€‚ ç”±äºŽè§£æžè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç›´æŽ¥ä¸Šä»£ç å¯èƒ½ä¼šå¯¼è‡´ä¸äº†è§£è¿™éƒ¨åˆ†å†…å®¹çš„åŒå­¦ä¸€å¤´é›¾æ°´ã€‚æ‰€ä»¥ç¬”è€…å‡†å¤‡æä¾›ä¸€ä¸ª template çš„ç¤ºä¾‹ï¼Œé€šè¿‡è¿™ä¸ªç¤ºä¾‹çš„å˜åŒ–æ¥çœ‹è§£æžçš„è¿‡ç¨‹ã€‚ä½†æ˜¯è§£æžçš„è¿‡ç¨‹åŠç»“æžœéƒ½æ˜¯å°†æœ€é‡è¦çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å±•ç¤ºï¼Œå¸Œæœ›èƒ½è®©è¯»è€…æ›´å¥½åœ°äº†è§£å…¶æ ¸å¿ƒéƒ¨åˆ†çš„å®žçŽ°ã€‚ 123&lt;div :class=&quot;c&quot; class=&quot;demo&quot; v-if=&quot;isShow&quot;&gt; &lt;span v-for=&quot;item in sz&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;&lt;/div&gt; 1var html = &apos;&lt;div :class=&quot;c&quot; class=&quot;demo&quot; v-if=&quot;isShow&quot;&gt;&lt;span v-for=&quot;item in sz&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/span&gt;&lt;/div&gt;&apos;; æŽ¥ä¸‹æ¥çš„è¿‡ç¨‹éƒ½ä¼šä¾èµ–è¿™ä¸ªç¤ºä¾‹æ¥è¿›è¡Œã€‚ parseé¦–å…ˆæ˜¯ parseï¼Œparse ä¼šç”¨æ­£åˆ™ç­‰æ–¹å¼å°† template æ¨¡æ¿ä¸­è¿›è¡Œå­—ç¬¦ä¸²è§£æžï¼Œå¾—åˆ°æŒ‡ä»¤ã€classã€styleç­‰æ•°æ®ï¼Œå½¢æˆ ASTï¼ˆåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ï¼ˆabstract syntax treeæˆ–è€…ç¼©å†™ä¸ºASTï¼‰ï¼Œæˆ–è€…è¯­æ³•æ ‘ï¼ˆsyntax treeï¼‰ï¼Œæ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æž„çš„æ ‘çŠ¶è¡¨çŽ°å½¢å¼ï¼Œè¿™é‡Œç‰¹æŒ‡ç¼–ç¨‹è¯­è¨€çš„æºä»£ç ã€‚ï¼‰ã€‚ è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¼šæ¶‰åŠåˆ°æ¯”è¾ƒå¤šçš„æ­£åˆ™è¿›è¡Œå­—ç¬¦ä¸²è§£æžï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¾—åˆ°çš„ AST çš„æ ·å­ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344&#123; /* æ ‡ç­¾å±žæ€§çš„mapï¼Œè®°å½•äº†æ ‡ç­¾ä¸Šå±žæ€§ */ &apos;attrsMap&apos;: &#123; &apos;:class&apos;: &apos;c&apos;, &apos;class&apos;: &apos;demo&apos;, &apos;v-if&apos;: &apos;isShow&apos; &#125;, /* è§£æžå¾—åˆ°çš„:class */ &apos;classBinding&apos;: &apos;c&apos;, /* æ ‡ç­¾å±žæ€§v-if */ &apos;if&apos;: &apos;isShow&apos;, /* v-ifçš„æ¡ä»¶ */ &apos;ifConditions&apos;: [ &#123; &apos;exp&apos;: &apos;isShow&apos; &#125; ], /* æ ‡ç­¾å±žæ€§class */ &apos;staticClass&apos;: &apos;demo&apos;, /* æ ‡ç­¾çš„tag */ &apos;tag&apos;: &apos;div&apos;, /* å­æ ‡ç­¾æ•°ç»„ */ &apos;children&apos;: [ &#123; &apos;attrsMap&apos;: &#123; &apos;v-for&apos;: &quot;item in sz&quot; &#125;, /* forå¾ªçŽ¯çš„å‚æ•° */ &apos;alias&apos;: &quot;item&quot;, /* forå¾ªçŽ¯çš„å¯¹è±¡ */ &apos;for&apos;: &apos;sz&apos;, /* forå¾ªçŽ¯æ˜¯å¦å·²ç»è¢«å¤„ç†çš„æ ‡è®°ä½ */ &apos;forProcessed&apos;: true, &apos;tag&apos;: &apos;span&apos;, &apos;children&apos;: [ &#123; /* è¡¨è¾¾å¼ï¼Œ_sæ˜¯ä¸€ä¸ªè½¬å­—ç¬¦ä¸²çš„å‡½æ•° */ &apos;expression&apos;: &apos;_s(item)&apos;, &apos;text&apos;: &apos;&#123;&#123;item&#125;&#125;&apos; &#125; ] &#125; ]&#125; æœ€ç»ˆå¾—åˆ°çš„ AST é€šè¿‡ä¸€äº›ç‰¹å®šçš„å±žæ€§ï¼Œèƒ½å¤Ÿæ¯”è¾ƒæ¸…æ™°åœ°æè¿°å‡ºæ ‡ç­¾çš„å±žæ€§ä»¥åŠä¾èµ–å…³ç³»ã€‚ æŽ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä»£ç æ¥è®²è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ­£åˆ™æ¥æŠŠ template ç¼–è¯‘æˆæˆ‘ä»¬éœ€è¦çš„ AST çš„ã€‚ æ­£åˆ™é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹æŽ¥ä¸‹æ¥æˆ‘ä»¬ä¼šç”¨åˆ°çš„æ­£åˆ™ã€‚ 1234567891011121314151617181920212223const ncname = &apos;[a-zA-Z_][\\w\\-\\.]*&apos;;const singleAttrIdentifier = /([^\s&quot;&apos;&lt;&gt;/=]+)/const singleAttrAssign = /(?:=)/const singleAttrValues = [ /&quot;([^&quot;]*)&quot;+/.source, /&apos;([^&apos;]*)&apos;+/.source, /([^\s&quot;&apos;=&lt;&gt;`]+)/.source]const attribute = new RegExp( &apos;^\\s*&apos; + singleAttrIdentifier.source + &apos;(?:\\s*(&apos; + singleAttrAssign.source + &apos;)&apos; + &apos;\\s*(?:&apos; + singleAttrValues.join(&apos;|&apos;) + &apos;))?&apos;)const qnameCapture = &apos;((?:&apos; + ncname + &apos;\\:)?&apos; + ncname + &apos;)&apos;const startTagOpen = new RegExp(&apos;^&lt;&apos; + qnameCapture)const startTagClose = /^\s*(\/?)&gt;/const endTag = new RegExp(&apos;^&lt;\\/&apos; + qnameCapture + &apos;[^&gt;]*&gt;&apos;)const defaultTagRE = /\&#123;\&#123;((?:.|\n)+?)\&#125;\&#125;/gconst forAliasRE = /(.*?)\s+(?:in|of)\s+(.*)/ advanceå› ä¸ºæˆ‘ä»¬è§£æž template é‡‡ç”¨å¾ªçŽ¯è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…çš„æ–¹å¼ï¼Œæ‰€ä»¥æ¯åŒ¹é…è§£æžå®Œä¸€æ®µæˆ‘ä»¬éœ€è¦å°†å·²ç»åŒ¹é…æŽ‰çš„åŽ»æŽ‰ï¼Œå¤´éƒ¨çš„æŒ‡é’ˆæŒ‡å‘æŽ¥ä¸‹æ¥éœ€è¦åŒ¹é…çš„éƒ¨åˆ†ã€‚ 1234function advance (n) &#123; index += n html = html.substring(n)&#125; ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ª div çš„å¤´æ ‡ç­¾å…¨éƒ¨åŒ¹é…å®Œæ¯•ä»¥åŽï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™éƒ¨åˆ†é™¤åŽ»ï¼Œä¹Ÿå°±æ˜¯å‘å³ç§»åŠ¨ 43 ä¸ªå­—ç¬¦ã€‚ è°ƒç”¨ advance å‡½æ•° 1advance(43); å¾—åˆ°ç»“æžœ parseHTMLé¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸ª parseHTML å‡½æ•°ï¼Œåœ¨é‡Œé¢æˆ‘ä»¬å¾ªçŽ¯è§£æž template å­—ç¬¦ä¸²ã€‚ 123456789101112131415161718function parseHTML () &#123; while(html) &#123; let textEnd = html.indexOf(&apos;&lt;&apos;); if (textEnd === 0) &#123; if (html.match(endTag)) &#123; //...process end tag continue; &#125; if (html.match(startTagOpen)) &#123; //...process start tag continue; &#125; &#125; else &#123; //...process text continue; &#125; &#125;&#125; parseHTML ä¼šç”¨ while æ¥å¾ªçŽ¯è§£æž template ï¼Œç”¨æ­£åˆ™åœ¨åŒ¹é…åˆ°æ ‡ç­¾å¤´ã€æ ‡ç­¾å°¾ä»¥åŠæ–‡æœ¬çš„æ—¶å€™åˆ†åˆ«è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚ç›´åˆ°æ•´ä¸ª template è¢«è§£æžå®Œæ¯•ã€‚ parseStartTagæˆ‘ä»¬æ¥å†™ä¸€ä¸ª parseStartTag å‡½æ•°ï¼Œç”¨æ¥è§£æžèµ·å§‹æ ‡ç­¾ï¼ˆâ€â€œéƒ¨åˆ†çš„å†…å®¹ï¼‰ã€‚ 1234567891011121314151617181920212223242526function parseStartTag () &#123; const start = html.match(startTagOpen); if (start) &#123; const match = &#123; tagName: start[1], attrs: [], start: index &#125; advance(start[0].length); let end, attr while (!(end = html.match(startTagClose)) &amp;&amp; (attr = html.match(attribute))) &#123; advance(attr[0].length) match.attrs.push(&#123; name: attr[1], value: attr[3] &#125;); &#125; if (end) &#123; match.unarySlash = end[1]; advance(end[0].length); match.end = index; return match &#125; &#125;&#125; é¦–å…ˆç”¨ startTagOpen æ­£åˆ™å¾—åˆ°æ ‡ç­¾çš„å¤´éƒ¨ï¼Œå¯ä»¥å¾—åˆ° tagNameï¼ˆæ ‡ç­¾åç§°ï¼‰ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„ attrs ç”¨æ¥å­˜æ”¾æ ‡ç­¾å†…çš„å±žæ€§ã€‚ 1234567const start = html.match(startTagOpen);const match = &#123; tagName: start[1], attrs: [], start: index&#125;advance(start[0].length); æŽ¥ä¸‹æ¥ä½¿ç”¨ startTagClose ä¸Ž attribute ä¸¤ä¸ªæ­£åˆ™åˆ†åˆ«ç”¨æ¥è§£æžæ ‡ç­¾ç»“æŸä»¥åŠæ ‡ç­¾å†…çš„å±žæ€§ã€‚è¿™æ®µä»£ç ç”¨ while å¾ªçŽ¯ä¸€ç›´åˆ°åŒ¹é…åˆ° startTagClose ä¸ºæ­¢ï¼Œè§£æžå†…éƒ¨æ‰€æœ‰çš„å±žæ€§ã€‚ 1234567891011121314let end, attrwhile (!(end = html.match(startTagClose)) &amp;&amp; (attr = html.match(attribute))) &#123; advance(attr[0].length) match.attrs.push(&#123; name: attr[1], value: attr[3] &#125;);&#125;if (end) &#123; match.unarySlash = end[1]; advance(end[0].length); match.end = index; return match&#125; stackæ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ª stack æ ˆæ¥ä¿å­˜å·²ç»è§£æžå¥½çš„æ ‡ç­¾å¤´ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®åœ¨è§£æžå°¾éƒ¨æ ‡ç­¾çš„æ—¶å€™å¾—åˆ°æ‰€å±žçš„å±‚çº§å…³ç³»ä»¥åŠçˆ¶æ ‡ç­¾ã€‚åŒæ—¶æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª currentParent å˜é‡ç”¨æ¥å­˜æ”¾å½“å‰æ ‡ç­¾çš„çˆ¶æ ‡ç­¾èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œ root å˜é‡ç”¨æ¥æŒ‡å‘æ ¹æ ‡ç­¾èŠ‚ç‚¹ã€‚ 12const stack = [];let currentParent, root; çŸ¥é“è¿™ä¸ªä»¥åŽï¼Œæˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹ parseHTML ï¼Œåœ¨ startTagOpen çš„ if é€»è¾‘ä¸­åŠ ä¸Šæ–°çš„å¤„ç†ã€‚ 123456789101112131415161718192021222324if (html.match(startTagOpen)) &#123; const startTagMatch = parseStartTag(); const element = &#123; type: 1, tag: startTagMatch.tagName, lowerCasedTag: startTagMatch.tagName.toLowerCase(), attrsList: startTagMatch.attrs, attrsMap: makeAttrsMap(startTagMatch.attrs), parent: currentParent, children: [] &#125; if(!root)&#123; root = element &#125; if(currentParent)&#123; currentParent.children.push(element); &#125; stack.push(element); currentParent = element; continue;&#125; æˆ‘ä»¬å°† startTagMatch å¾—åˆ°çš„ç»“æžœé¦–å…ˆå°è£…æˆ element ï¼Œè¿™ä¸ªå°±æ˜¯æœ€ç»ˆå½¢æˆçš„ AST çš„èŠ‚ç‚¹ï¼Œæ ‡ç­¾èŠ‚ç‚¹çš„ type ä¸º 1ã€‚ 123456789const startTagMatch = parseStartTag();const element = &#123; type: 1, tag: startTagMatch.tagName, attrsList: startTagMatch.attrs, attrsMap: makeAttrsMap(startTagMatch.attrs), parent: currentParent, children: []&#125; ç„¶åŽè®© root æŒ‡å‘æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ 123if(!root)&#123; root = element&#125; æŽ¥ç€æˆ‘ä»¬å°†å½“å‰èŠ‚ç‚¹çš„ element æ”¾å…¥çˆ¶èŠ‚ç‚¹ currentParent çš„ children æ•°ç»„ä¸­ã€‚ 123if(currentParent)&#123; currentParent.children.push(element);&#125; æœ€åŽå°†å½“å‰èŠ‚ç‚¹ element åŽ‹å…¥ stack æ ˆä¸­ï¼Œå¹¶å°† currentParent æŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œå› ä¸ºæŽ¥ä¸‹åŽ»ä¸‹ä¸€ä¸ªè§£æžå¦‚æžœè¿˜æ˜¯å¤´æ ‡ç­¾æˆ–è€…æ˜¯æ–‡æœ¬çš„è¯ï¼Œä¼šæˆä¸ºå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¦‚æžœæ˜¯å°¾æ ‡ç­¾çš„è¯ï¼Œé‚£ä¹ˆå°†ä¼šä»Žæ ˆä¸­å–å‡ºå½“å‰èŠ‚ç‚¹ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬æŽ¥ä¸‹æ¥è¦è®²ã€‚ 123stack.push(element);currentParent = element;continue; å…¶ä¸­çš„ makeAttrsMap æ˜¯å°† attrs è½¬æ¢æˆ map æ ¼å¼çš„ä¸€ä¸ªæ–¹æ³•ã€‚ 1234567function makeAttrsMap (attrs) &#123; const map = &#123;&#125; for (let i = 0, l = attrs.length; i &lt; l; i++) &#123; map[attrs[i].name] = attrs[i].value; &#125; return map&#125; parseEndTagåŒæ ·ï¼Œæˆ‘ä»¬åœ¨ parseHTML ä¸­åŠ å…¥å¯¹å°¾æ ‡ç­¾çš„è§£æžå‡½æ•°ï¼Œä¸ºäº†åŒ¹é…å¦‚â€œâ€ã€‚ 123456const endTagMatch = html.match(endTag) if (endTagMatch) &#123; advance(endTagMatch[0].length); parseEndTag(endTagMatch[1]); continue;&#125; ç”¨ parseEndTag æ¥è§£æžå°¾æ ‡ç­¾ï¼Œå®ƒä¼šä»Ž stack æ ˆä¸­å–å‡ºæœ€è¿‘çš„è·Ÿè‡ªå·±æ ‡ç­¾åä¸€è‡´çš„é‚£ä¸ªå…ƒç´ ï¼Œå°† currentParent æŒ‡å‘é‚£ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ ä¹‹å‰çš„å…ƒç´ éƒ½ä»Ž stack ä¸­å‡ºæ ˆã€‚ è¿™é‡Œå¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼Œéš¾é“è§£æžçš„å°¾å…ƒç´ ä¸åº”è¯¥å¯¹åº” stack æ ˆçš„æœ€ä¸Šé¢çš„ä¸€ä¸ªå…ƒç´ æ‰å¯¹å—ï¼Ÿ å…¶å®žä¸ç„¶ï¼Œæ¯”å¦‚è¯´å¯èƒ½ä¼šå­˜åœ¨è‡ªé—­åˆçš„æ ‡ç­¾ï¼Œå¦‚â€œâ€ï¼Œæˆ–è€…æ˜¯å†™äº†â€œâ€ä½†æ˜¯æ²¡æœ‰åŠ ä¸Šâ€œ&lt; /span&gt;â€çš„æƒ…å†µï¼Œè¿™æ—¶å€™å°±è¦æ‰¾åˆ° stack ä¸­çš„ç¬¬äºŒä¸ªä½ç½®æ‰èƒ½æ‰¾åˆ°åŒåæ ‡ç­¾ã€‚ 12345678910111213function parseEndTag (tagName) &#123; let pos; for (pos = stack.length - 1; pos &gt;= 0; pos--) &#123; if (stack[pos].lowerCasedTag === tagName.toLowerCase()) &#123; break; &#125; &#125; if (pos &gt;= 0) &#123; stack.length = pos; currentParent = stack[pos]; &#125; &#125; parseTextæœ€åŽæ˜¯è§£æžæ–‡æœ¬ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦å°†æ–‡æœ¬å–å‡ºï¼Œç„¶åŽæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ™®é€šçš„æ–‡æœ¬ï¼Œç›´æŽ¥æž„å»ºä¸€ä¸ªèŠ‚ç‚¹ push è¿›å½“å‰ currentParent çš„ children ä¸­å³å¯ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯æ–‡æœ¬æ˜¯å¦‚â€œâ€è¿™æ ·çš„ Vue.js çš„è¡¨è¾¾å¼ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨ parseText æ¥å°†è¡¨è¾¾å¼è½¬åŒ–æˆä»£ç ã€‚ 12345678910111213141516text = html.substring(0, textEnd)advance(textEnd)let expression;if (expression = parseText(text)) &#123; currentParent.children.push(&#123; type: 2, text, expression &#125;);&#125; else &#123; currentParent.children.push(&#123; type: 3, text, &#125;);&#125;continue; æˆ‘ä»¬ä¼šç”¨åˆ°ä¸€ä¸ª parseText å‡½æ•°ã€‚ 1234567891011121314151617181920212223function parseText (text) &#123; if (!defaultTagRE.test(text)) return; const tokens = []; let lastIndex = defaultTagRE.lastIndex = 0 let match, index while ((match = defaultTagRE.exec(text))) &#123; index = match.index if (index &gt; lastIndex) &#123; tokens.push(JSON.stringify(text.slice(lastIndex, index))) &#125; const exp = match[1].trim() tokens.push(`_s($&#123;exp&#125;)`) lastIndex = index + match[0].length &#125; if (lastIndex &lt; text.length) &#123; tokens.push(JSON.stringify(text.slice(lastIndex))) &#125; return tokens.join(&apos;+&apos;);&#125; æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª tokens æ•°ç»„æ¥å­˜æ”¾è§£æžç»“æžœï¼Œé€šè¿‡ defaultTagRE æ¥å¾ªçŽ¯åŒ¹é…è¯¥æ–‡æœ¬ï¼Œå¦‚æžœæ˜¯æ™®é€šæ–‡æœ¬ç›´æŽ¥ push åˆ° tokens æ•°ç»„ä¸­åŽ»ï¼Œå¦‚æžœæ˜¯è¡¨è¾¾å¼ï¼ˆï¼‰ï¼Œåˆ™è½¬åŒ–æˆâ€œ_s(${exp})â€çš„å½¢å¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ–‡æœ¬ã€‚ 1&lt;div&gt;hello,&#123;&#123;name&#125;&#125;.&lt;/div&gt; æœ€ç»ˆå¾—åˆ° tokensã€‚ 1tokens = [&apos;hello,&apos;, _s(name), &apos;.&apos;]; æœ€ç»ˆé€šè¿‡ join è¿”å›žè¡¨è¾¾å¼ã€‚ 1&apos;hello&apos; + _s(name) + &apos;.&apos;; processIfä¸ŽprocessForæœ€åŽä»‹ç»ä¸€ä¸‹å¦‚ä½•å¤„ç†â€œv-ifâ€ä»¥åŠâ€œv-forâ€è¿™æ ·çš„ Vue.js çš„è¡¨è¾¾å¼çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åªç®€å•ä»‹ç»ä¸¤ä¸ªç¤ºä¾‹ä¸­ç”¨åˆ°çš„è¡¨è¾¾å¼è§£æžã€‚ æˆ‘ä»¬åªéœ€è¦åœ¨è§£æžå¤´æ ‡ç­¾çš„å†…å®¹ä¸­åŠ å…¥è¿™ä¸¤ä¸ªè¡¨è¾¾å¼çš„è§£æžå‡½æ•°å³å¯ï¼Œåœ¨è¿™æ—¶â€œv-forâ€ä¹‹ç±»æŒ‡ä»¤å·²ç»åœ¨å±žæ€§è§£æžæ—¶å­˜å…¥äº† attrsMap ä¸­äº†ã€‚ 1234567891011121314151617181920212223242526if (html.match(startTagOpen)) &#123; const startTagMatch = parseStartTag(); const element = &#123; type: 1, tag: startTagMatch.tagName, attrsList: startTagMatch.attrs, attrsMap: makeAttrsMap(startTagMatch.attrs), parent: currentParent, children: [] &#125; processIf(element); processFor(element); if(!root)&#123; root = element &#125; if(currentParent)&#123; currentParent.children.push(element); &#125; stack.push(element); currentParent = element; continue;&#125; é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª getAndRemoveAttr å‡½æ•°ï¼Œç”¨æ¥ä»Ž el çš„ attrsMap å±žæ€§æˆ–æ˜¯ attrsList å±žæ€§ä¸­å–å‡º name å¯¹åº”å€¼ã€‚ 12345678910111213function getAndRemoveAttr (el, name) &#123; let val if ((val = el.attrsMap[name]) != null) &#123; const list = el.attrsList for (let i = 0, l = list.length; i &lt; l; i++) &#123; if (list[i].name === name) &#123; list.splice(i, 1) break &#125; &#125; &#125; return val&#125; æ¯”å¦‚è¯´è§£æžç¤ºä¾‹çš„ div æ ‡ç­¾å±žæ€§ã€‚ 1getAndRemoveAttr(el, &apos;v-for&apos;); å¯æœ‰å¾—åˆ°â€œitem in szâ€ã€‚ æœ‰äº†è¿™ä¸ªå‡½æ•°è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å®žçŽ° processFor ä¸Ž processIf äº†ã€‚ â€œv-forâ€ä¼šå°†æŒ‡ä»¤è§£æžæˆ for å±žæ€§ä»¥åŠ alias å±žæ€§ï¼Œè€Œâ€œv-ifâ€ä¼šå°†æ¡ä»¶éƒ½å­˜å…¥ ifConditions æ•°ç»„ä¸­ã€‚ 12345678910111213141516171819202122function processFor (el) &#123; let exp; if ((exp = getAndRemoveAttr(el, &apos;v-for&apos;))) &#123; const inMatch = exp.match(forAliasRE); el.for = inMatch[2].trim(); el.alias = inMatch[1].trim(); &#125;&#125;function processIf (el) &#123; const exp = getAndRemoveAttr(el, &apos;v-if&apos;); if (exp) &#123; el.if = exp; if (!el.ifConditions) &#123; el.ifConditions = []; &#125; el.ifConditions.push(&#123; exp: exp, block: el &#125;); &#125;&#125; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æŠŠ parse çš„è¿‡ç¨‹ä»‹ç»å®Œäº†ï¼ŒæŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ optimizeã€‚ optimizeoptimize ä¸»è¦ä½œç”¨å°±è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œç”¨ä½œã€Œä¼˜åŒ–ã€ã€‚ è¿™ä¸ªæ¶‰åŠåˆ°åŽé¢è¦è®² patch çš„è¿‡ç¨‹ï¼Œå› ä¸º patch çš„è¿‡ç¨‹å®žé™…ä¸Šæ˜¯å°† VNode èŠ‚ç‚¹è¿›è¡Œä¸€å±‚ä¸€å±‚çš„æ¯”å¯¹ï¼Œç„¶åŽå°†ã€Œå·®å¼‚ã€æ›´æ–°åˆ°è§†å›¾ä¸Šã€‚é‚£ä¹ˆä¸€äº›é™æ€èŠ‚ç‚¹æ˜¯ä¸ä¼šæ ¹æ®æ•°æ®å˜åŒ–è€Œäº§ç”Ÿå˜åŒ–çš„ï¼Œè¿™äº›èŠ‚ç‚¹æˆ‘ä»¬æ²¡æœ‰æ¯”å¯¹çš„éœ€æ±‚ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è·³è¿‡è¿™äº›é™æ€èŠ‚ç‚¹çš„æ¯”å¯¹ï¼Œä»Žè€ŒèŠ‚çœä¸€äº›æ€§èƒ½å‘¢ï¼Ÿ é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸ºé™æ€çš„èŠ‚ç‚¹åšä¸Šä¸€äº›ã€Œæ ‡è®°ã€ï¼Œåœ¨ patch çš„æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç›´æŽ¥è·³è¿‡è¿™äº›è¢«æ ‡è®°çš„èŠ‚ç‚¹çš„æ¯”å¯¹ï¼Œä»Žè€Œè¾¾åˆ°ã€Œä¼˜åŒ–ã€çš„ç›®çš„ã€‚ ç»è¿‡ optimize è¿™å±‚çš„å¤„ç†ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåŠ ä¸Š static å±žæ€§ï¼Œç”¨æ¥æ ‡è®°æ˜¯å¦æ˜¯é™æ€çš„ã€‚ å¾—åˆ°å¦‚ä¸‹ç»“æžœã€‚ 1234567891011121314151617181920212223242526272829303132333435&#123; &apos;attrsMap&apos;: &#123; &apos;:class&apos;: &apos;c&apos;, &apos;class&apos;: &apos;demo&apos;, &apos;v-if&apos;: &apos;isShow&apos; &#125;, &apos;classBinding&apos;: &apos;c&apos;, &apos;if&apos;: &apos;isShow&apos;, &apos;ifConditions&apos;: [ &apos;exp&apos;: &apos;isShow&apos; ], &apos;staticClass&apos;: &apos;demo&apos;, &apos;tag&apos;: &apos;div&apos;, /* é™æ€æ ‡å¿— */ &apos;static&apos;: false, &apos;children&apos;: [ &#123; &apos;attrsMap&apos;: &#123; &apos;v-for&apos;: &quot;item in sz&quot; &#125;, &apos;static&apos;: false, &apos;alias&apos;: &quot;item&quot;, &apos;for&apos;: &apos;sz&apos;, &apos;forProcessed&apos;: true, &apos;tag&apos;: &apos;span&apos;, &apos;children&apos;: [ &#123; &apos;expression&apos;: &apos;_s(item)&apos;, &apos;text&apos;: &apos;&#123;&#123;item&#125;&#125;&apos;, &apos;static&apos;: false &#125; ] &#125; ]&#125; æˆ‘ä»¬ç”¨ä»£ç å®žçŽ°ä¸€ä¸‹ optimize å‡½æ•°ã€‚ isStaticé¦–å…ˆå®žçŽ°ä¸€ä¸ª isStatic å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª node åˆ¤æ–­è¯¥ node æ˜¯å¦æ˜¯é™æ€èŠ‚ç‚¹ã€‚åˆ¤æ–­çš„æ ‡å‡†æ˜¯å½“ type ä¸º 2ï¼ˆè¡¨è¾¾å¼èŠ‚ç‚¹ï¼‰åˆ™æ˜¯éžé™æ€èŠ‚ç‚¹ï¼Œå½“ type ä¸º 3ï¼ˆæ–‡æœ¬èŠ‚ç‚¹ï¼‰çš„æ—¶å€™åˆ™æ˜¯é™æ€èŠ‚ç‚¹ï¼Œå½“ç„¶ï¼Œå¦‚æžœå­˜åœ¨ if æˆ–è€… forè¿™æ ·çš„æ¡ä»¶çš„æ—¶å€™ï¼ˆè¡¨è¾¾å¼èŠ‚ç‚¹ï¼‰ï¼Œä¹Ÿæ˜¯éžé™æ€èŠ‚ç‚¹ã€‚ 123456789function isStatic (node) &#123; if (node.type === 2) &#123; return false &#125; if (node.type === 3) &#123; return true &#125; return (!node.if &amp;&amp; !node.for);&#125; markStaticmarkStatic ä¸ºæ‰€æœ‰çš„èŠ‚ç‚¹æ ‡è®°ä¸Š staticï¼ŒéåŽ†æ‰€æœ‰èŠ‚ç‚¹é€šè¿‡ isStatic æ¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯é™æ€èŠ‚ç‚¹ï¼Œæ­¤å¤–ï¼Œä¼šéåŽ†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå¦‚æžœå­èŠ‚ç‚¹æ˜¯éžé™æ€èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹ä¹Ÿæ˜¯éžé™æ€èŠ‚ç‚¹ã€‚ 123456789101112function markStatic (node) &#123; node.static = isStatic(node); if (node.type === 1) &#123; for (let i = 0, l = node.children.length; i &lt; l; i++) &#123; const child = node.children[i]; markStatic(child); if (!child.static) &#123; node.static = false; &#125; &#125; &#125;&#125; markStaticRootsæŽ¥ä¸‹æ¥æ˜¯ markStaticRoots å‡½æ•°ï¼Œç”¨æ¥æ ‡è®° staticRootï¼ˆé™æ€æ ¹ï¼‰ã€‚è¿™ä¸ªå‡½æ•°å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œç®€å•æ¥å°†å°±æ˜¯å¦‚æžœå½“å‰èŠ‚ç‚¹æ˜¯é™æ€èŠ‚ç‚¹ï¼ŒåŒæ—¶æ»¡è¶³è¯¥èŠ‚ç‚¹å¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹å·¦å³å­èŠ‚ç‚¹ï¼ˆä½œè€…è®¤ä¸ºè¿™ç§æƒ…å†µçš„ä¼˜åŒ–æ¶ˆè€—ä¼šå¤§äºŽæ”¶ç›Šï¼‰æ—¶ï¼Œæ ‡è®° staticRoot ä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚ 12345678910111213function markStaticRoots (node) &#123; if (node.type === 1) &#123; if (node.static &amp;&amp; node.children.length &amp;&amp; !( node.children.length === 1 &amp;&amp; node.children[0].type === 3 )) &#123; node.staticRoot = true; return; &#125; else &#123; node.staticRoot = false; &#125; &#125;&#125; optimizeæœ‰äº†ä»¥ä¸Šçš„å‡½æ•°ï¼Œå°±å¯ä»¥å®žçŽ° optimize äº†ã€‚ 1234function optimize (rootAst) &#123; markStatic(rootAst); markStaticRoots(rootAst);&#125; generategenerate ä¼šå°† AST è½¬åŒ–æˆ render funtion å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆå¾—åˆ° render çš„å­—ç¬¦ä¸²ä»¥åŠ staticRenderFns å­—ç¬¦ä¸²ã€‚ é¦–å…ˆå¸¦å¤§å®¶æ„Ÿå—ä¸€ä¸‹çœŸå®žçš„ Vue.js ç¼–è¯‘å¾—åˆ°çš„ç»“æžœã€‚ 1234567891011121314151617with(this)&#123; return (isShow) ? _c( &apos;div&apos;, &#123; staticClass: &quot;demo&quot;, class: c &#125;, _l( (sz), function(item)&#123; return _c(&apos;span&apos;,[_v(_s(item))]) &#125; ) ) : _e()&#125; çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šçº³é—·äº†ï¼Œè¿™äº› _cï¼Œ_l åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®žä»–ä»¬æ˜¯ Vue.js å¯¹ä¸€äº›å‡½æ•°çš„ç®€å†™ï¼Œæ¯”å¦‚è¯´ _c å¯¹åº”çš„æ˜¯ createElement è¿™ä¸ªå‡½æ•°ã€‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬æŠŠå®ƒç”¨ VNode çš„å½¢å¼å†™å‡ºæ¥å°±ä¼šæ˜Žç™½äº†ï¼Œè¿™ä¸ªå¯¹æŽ¥ä¸Šä¸€ç« å†™çš„ VNode å‡½æ•°ã€‚ é¦–å…ˆæ˜¯ç¬¬ä¸€å±‚ div èŠ‚ç‚¹ã€‚ 123456render () &#123; return isShow ? (new VNode(&apos;div&apos;, &#123; &apos;staticClass&apos;: &apos;demo&apos;, &apos;class&apos;: c &#125;, [ /*è¿™é‡Œè¿˜æœ‰å­èŠ‚ç‚¹*/ ])) : createEmptyVNode();&#125; ç„¶åŽæˆ‘ä»¬åœ¨ children ä¸­åŠ ä¸Šç¬¬äºŒå±‚ span åŠå…¶å­æ–‡æœ¬èŠ‚ç‚¹èŠ‚ç‚¹ã€‚ 12345678910111213141516171819202122/* æ¸²æŸ“v-foråˆ—è¡¨ */function renderList (val, render) &#123; let ret = new Array(val.length); for (i = 0, l = val.length; i &lt; l; i++) &#123; ret[i] = render(val[i], i); &#125;&#125;render () &#123; return isShow ? (new VNode(&apos;div&apos;, &#123; &apos;staticClass&apos;: &apos;demo&apos;, &apos;class&apos;: c &#125;, /* begin */ renderList(sz, (item) =&gt; &#123; return new VNode(&apos;span&apos;, &#123;&#125;, [ createTextVNode(item); ]); &#125;) /* end */ )) : createEmptyVNode();&#125; é‚£æˆ‘ä»¬å¦‚ä½•æ¥å®žçŽ°ä¸€ä¸ª generate å‘¢ï¼Ÿ genIfé¦–å…ˆå®žçŽ°ä¸€ä¸ªå¤„ç† if æ¡ä»¶çš„ genIf å‡½æ•°ã€‚ 1234567function genIf (el) &#123; el.ifProcessed = true; if (!el.ifConditions.length) &#123; return &apos;_e()&apos;; &#125; return `($&#123;el.ifConditions[0].exp&#125;)?$&#123;genElement(el.ifConditions[0].block)&#125;: _e()`&#125; genForç„¶åŽæ˜¯å¤„ç† for å¾ªçŽ¯çš„å‡½æ•°ã€‚ 12345678910111213function genFor (el) &#123; el.forProcessed = true; const exp = el.for; const alias = el.alias; const iterator1 = el.iterator1 ? `,$&#123;el.iterator1&#125;` : &apos;&apos;; const iterator2 = el.iterator2 ? `,$&#123;el.iterator2&#125;` : &apos;&apos;; return `_l(($&#123;exp&#125;),` + `function($&#123;alias&#125;$&#123;iterator1&#125;$&#123;iterator2&#125;)&#123;` + `return $&#123;genElement(el)&#125;` + &apos;&#125;)&apos;;&#125; genTextå¤„ç†æ–‡æœ¬èŠ‚ç‚¹çš„å‡½æ•°ã€‚ 123function genText (el) &#123; return `_v($&#123;el.expression&#125;)`;&#125; genElementæŽ¥ä¸‹æ¥å®žçŽ°ä¸€ä¸‹ genElementï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç†èŠ‚ç‚¹çš„å‡½æ•°ï¼Œå› ä¸ºå®ƒä¾èµ– genChildren ä»¥åŠg enNode ï¼Œæ‰€ä»¥è¿™ä¸‰ä¸ªå‡½æ•°æ”¾åœ¨ä¸€èµ·è®²ã€‚ genElementä¼šæ ¹æ®å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰ if æˆ–è€… for æ ‡è®°ç„¶åŽåˆ¤æ–­æ˜¯å¦è¦ç”¨ genIf æˆ–è€… genFor å¤„ç†ï¼Œå¦åˆ™é€šè¿‡ genChildren å¤„ç†å­èŠ‚ç‚¹ï¼ŒåŒæ—¶å¾—åˆ° staticClassã€class ç­‰å±žæ€§ã€‚ genChildren æ¯”è¾ƒç®€å•ï¼ŒéåŽ†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œé€šè¿‡ genNode å¤„ç†åŽç”¨â€œï¼Œâ€éš”å¼€æ‹¼æŽ¥æˆå­—ç¬¦ä¸²ã€‚ genNode åˆ™æ˜¯æ ¹æ® type æ¥åˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯ç”¨æ–‡æœ¬èŠ‚ç‚¹ genText è¿˜æ˜¯æ ‡ç­¾èŠ‚ç‚¹ genElement æ¥å¤„ç†ã€‚ 123456789101112131415161718192021222324252627282930313233function genNode (el) &#123; if (el.type === 1) &#123; return genElement(el); &#125; else &#123; return genText(el); &#125;&#125;function genChildren (el) &#123; const children = el.children; if (children &amp;&amp; children.length &gt; 0) &#123; return `$&#123;children.map(genNode).join(&apos;,&apos;)&#125;`; &#125;&#125;function genElement (el) &#123; if (el.if &amp;&amp; !el.ifProcessed) &#123; return genIf(el); &#125; else if (el.for &amp;&amp; !el.forProcessed) &#123; return genFor(el); &#125; else &#123; const children = genChildren(el); let code; code = `_c(&apos;$&#123;el.tag&#125;,&apos;&#123; staticClass: $&#123;el.attrsMap &amp;&amp; el.attrsMap[&apos;:class&apos;]&#125;, class: $&#123;el.attrsMap &amp;&amp; el.attrsMap[&apos;class&apos;]&#125;, &#125;$&#123; children ? `,$&#123;children&#125;` : &apos;&apos; &#125;)` return code; &#125;&#125; generateæœ€åŽæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„å‡½æ•°æ¥å®žçŽ° generateï¼Œå…¶å®žå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ•´ä¸ª AST ä¼ å…¥åŽåˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿”å›žä¸€ä¸ª div æ ‡ç­¾ï¼Œå¦åˆ™é€šè¿‡ generate æ¥å¤„ç†ã€‚ 123456function generate (rootAst) &#123; const code = rootAst ? genElement(rootAst) : &apos;_c(&quot;div&quot;)&apos; return &#123; render: `with(this)&#123;return $&#123;code&#125;&#125;`, &#125;&#125; ç»åŽ†è¿‡è¿™äº›è¿‡ç¨‹ä»¥åŽï¼Œæˆ‘ä»¬å·²ç»æŠŠ template é¡ºåˆ©è½¬æˆäº† render function äº†ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»‹ç» patch çš„è¿‡ç¨‹ï¼Œæ¥çœ‹ä¸€ä¸‹å…·ä½“ VNode èŠ‚ç‚¹å¦‚ä½•è¿›è¡Œå·®å¼‚çš„æ¯”å¯¹ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Štemplate æ¨¡æ¿æ˜¯æ€Žæ ·é€šè¿‡ Compile ç¼–è¯‘çš„ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ€»ç»“ & å¸¸è§é—®é¢˜è§£ç­”]]></title>
    <url>%2F2018%2F09%2F27%2F%E6%80%BB%E7%BB%93%20%26%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94%2F</url>
    <content type="text"><![CDATA[æ€»ç»“åœ¨æœ¬å°å†Œçš„ç¬¬ä¸€èŠ‚ä¸­ï¼Œç¬”è€…å¯¹ Vue.js å†…éƒ¨è¿è¡Œæœºåˆ¶åšäº†ä¸€ä¸ªå…¨å±€çš„æ¦‚è§ˆï¼Œå½“æ—¶é€šè¿‡ä¸‹é¢è¿™å¼ å›¾æŠŠ Vue.js æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªå°æ¨¡å—æ¥ä»‹ç»ï¼Œä¹‹åŽé€šè¿‡è¿™ä¸€ç³»åˆ—å°èŠ‚çš„å­¦ä¹ ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»å¯¹ Vue.js å†…éƒ¨çš„åŽŸç†æœ‰äº†ä¸€ä¸ªæ›´è¿›ä¸€æ­¥çš„äº†è§£ï¼Œå¯¹è¿™å¼ å›¾ä¹Ÿå†ä¹Ÿä¸ä¼šæ„Ÿè§‰åˆ°é‚£ä¹ˆé™Œç”Ÿã€‚ æ¯ä¸ªå°èŠ‚ä¸­çš„ä»£ç éƒ½æ˜¯ç¬”è€…æ ¹æ® Vue.js åŽŸç†å•ç‹¬æŠ½ç¦»å‡ºæ¥å†™æˆçš„ Demoï¼Œå¤§å®¶å¯ä»¥åœ¨æˆ‘çš„ Gtihub ä¸ŠæŸ¥çœ‹å®Œæ•´çš„ä»£ç  (è§ VueDemo é¡¹ç›®)ã€‚ æœ¬å°å†Œå¯¹ Vue.js åŽŸç†è¿›è¡Œäº†åˆæ­¥çš„ä»‹ç»ï¼Œå¸Œæœ›èƒ½å¤Ÿèµ·åˆ°ä¸€ä¸ªæŠ›ç –å¼•çŽ‰çš„ä½œç”¨ï¼Œè¯»è€…è¯»å®Œä»¥åŽï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›åŸºç¡€å¯¹ Vue.js è¿›è¡Œä¸€ä¸ªæ›´åŠ æ·±å…¥çš„æŽ¢ç´¢ï¼Œç›¸ä¿¡ä¼šæœ‰æ›´å¤§çš„æ”¶èŽ·ã€‚ å¸¸è§é—®é¢˜ æ€Žä¹ˆå®žçŽ° this._test æ”¹å˜è€Œä¸æ˜¯ this._data.test æ”¹å˜è§¦å‘æ›´æ–°ï¼Ÿ ç­”ï¼šå…¶å®žè¿™ä¸­é—´æœ‰ä¸€ä¸ªä»£ç†çš„è¿‡ç¨‹ã€‚ 1234567891011121314151617_proxy(options.data);function _proxy (data) &#123; const that = this; Object.keys(data).forEach(key =&gt; &#123; Object.defineProperty(that, key, &#123; configurable: true, enumerable: true, get: function proxyGetter () &#123; return that._data[key]; &#125;, set: function proxySetter (val) &#123; that._data[key] = val; &#125; &#125;) &#125;);&#125; æœ¬è´¨å°±æ˜¯é€šè¿‡ Object.defineProperty ä½¿åœ¨è®¿é—® this ä¸Šçš„æŸå±žæ€§æ—¶ä»Ž this._data ä¸­è¯»å–ï¼ˆå†™å…¥ï¼‰ã€‚ èƒ½ä¸èƒ½å°†ä¾èµ–æ”¶é›†ä¸­è®²åˆ°çš„ dep.addSub(Dep.target) æ”¹æˆ dep.addSub(new Watcher())å‘¢ï¼Ÿ ä¸ºäº†ä¾¿äºŽè¯»è€…ç†è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘å°†ä»£ç åšäº†ç®€åŒ–ï¼Œå®žé™…ä¸Šä¸€ä¸ª Watcher å¯¹è±¡å¯èƒ½ä¼šåœ¨å¤šä¸ª Dep ä¸­ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡ addSub éƒ½æ˜¯ä¸€ä¸ªæ–°çš„ Watcher å¯¹è±¡ï¼Œéœ€ä¾èµ– Dep.target è¿›è¡Œæ”¶é›†ï¼ˆå®žé™…ä¸Š Dep.target ä¹Ÿæ˜¯é€šè¿‡ Watcher å¯¹è±¡çš„ get æ–¹æ³•è°ƒç”¨ pushTarget å°†è‡ªèº«èµ‹å€¼ç»™ Dep.targetï¼‰ã€‚ æœ€åŽä»Ž 2017 å¹´ 12 æœˆå¼€å§‹å†™è¿™æœ¬å°å†Œåˆ°çŽ°åœ¨å·®ä¸å¤š 2 ä¸ªæœˆçš„æ—¶é—´ï¼Œè™½è¯´ä¹‹å‰å†™è¿‡ç±»ä¼¼çš„å†…å®¹ï¼Œä½†æ˜¯å°† Vue.js æºç æŠ½ç¦»æˆä¸€ä¸ªä¸€ä¸ª Demo è¿˜æ˜¯èŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œå¯¹äºŽè¿™æœ¬å°å†Œä¹Ÿæ˜¯å‰å‰åŽåŽæ”¹äº†å¥½å‡ æ¬¡æ‰è®©è‡ªå·±æ»¡æ„ã€‚ å› ä¸ºè¯»è€…çš„åŸºç¡€ä¸ä¸€è‡´ï¼Œè€Œå°å†Œçš„å®šä½æ˜¯åå‘äºŽå¯¹æ–°æ‰‹è¯»è€…æ›´åŠ å‹å¥½ï¼Œæ‰€ä»¥æˆ‘å°½é‡ç”¨æ›´åŠ æµ…æ˜¾æ˜“æ‡‚çš„æ–¹å¼åŽ»å†™è¿™æœ¬å°å†Œçš„å†…å®¹ã€‚å¸Œæœ›å¤§å®¶å¯ä»¥é€šè¿‡è¿™æœ¬å°å†Œåˆæ­¥æŽŒæ¡ Vue.js çš„åŽŸç†ï¼ŒæŽŒæ¡è¿™äº›åŽŸç†ä»¥åŽå†åŽ»å°è¯•é˜…è¯» Vue.js æºç ï¼Œç›¸ä¿¡ä¼šäº‹åŠåŠŸå€ï¼Œä¹Ÿä¼šå¯¹ Vue.js æœ‰æ›´æ·±ä¸€å±‚çš„ç†è§£ã€‚ End]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å“åº”å¼ç³»ç»Ÿçš„ä¾èµ–æ”¶é›†è¿½è¸ªåŽŸç†]]></title>
    <url>%2F2018%2F09%2F23%2F%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%E8%BF%BD%E8%B8%AA%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[# ä¸ºä»€ä¹ˆè¦ä¾èµ–æ”¶é›†ï¼Ÿå…ˆä¸¾ä¸ªæ —å­ðŸŒ° æˆ‘ä»¬çŽ°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ª Vue å¯¹è±¡ã€‚ 123456789101112new Vue(&#123; template: `&lt;div&gt; &lt;span&gt;&#123;&#123;text1&#125;&#125;&lt;/span&gt; &lt;span&gt;&#123;&#123;text2&#125;&#125;&lt;/span&gt; &lt;div&gt;`, data: &#123; text1: &apos;text1&apos;, text2: &apos;text2&apos;, text3: &apos;text3&apos; &#125;&#125;); ç„¶åŽæˆ‘ä»¬åšäº†è¿™ä¹ˆä¸€ä¸ªæ“ä½œã€‚ 1this.text3 = &apos;modify text3&apos;; æˆ‘ä»¬ä¿®æ”¹äº† data ä¸­ text3 çš„æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºè§†å›¾ä¸­å¹¶ä¸éœ€è¦ç”¨åˆ° text3 ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦è§¦å‘ä¸Šä¸€ç« æ‰€è®²çš„ cb å‡½æ•°æ¥æ›´æ–°è§†å›¾ï¼Œè°ƒç”¨ cb æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚ å†æ¥ä¸€ä¸ªæ —å­ðŸŒ° å‡è®¾æˆ‘ä»¬çŽ°åœ¨æœ‰ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å¤šä¸ª Vue å¯¹è±¡ä¸­ç”¨åˆ°å®ƒè¿›è¡Œå±•ç¤ºã€‚ 12345678910111213141516171819let globalObj = &#123; text1: &apos;text1&apos;&#125;;let o1 = new Vue(&#123; template: `&lt;div&gt; &lt;span&gt;&#123;&#123;text1&#125;&#125;&lt;/span&gt; &lt;div&gt;`, data: globalObj&#125;);let o2 = new Vue(&#123; template: `&lt;div&gt; &lt;span&gt;&#123;&#123;text1&#125;&#125;&lt;/span&gt; &lt;div&gt;`, data: globalObj&#125;); è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ‰§è¡Œäº†å¦‚ä¸‹æ“ä½œã€‚ 1globalObj.text1 = &apos;hello,text1&apos;; æˆ‘ä»¬åº”è¯¥éœ€è¦é€šçŸ¥ o1 ä»¥åŠ o2 ä¸¤ä¸ªvmå®žä¾‹è¿›è¡Œè§†å›¾çš„æ›´æ–°ï¼Œã€Œä¾èµ–æ”¶é›†ã€ä¼šè®© text1 è¿™ä¸ªæ•°æ®çŸ¥é“â€œå“¦ï½žæœ‰ä¸¤ä¸ªåœ°æ–¹ä¾èµ–æˆ‘çš„æ•°æ®ï¼Œæˆ‘å˜åŒ–çš„æ—¶å€™éœ€è¦é€šçŸ¥å®ƒä»¬ï½žâ€ã€‚ æœ€ç»ˆä¼šå½¢æˆæ•°æ®ä¸Žè§†å›¾çš„ä¸€ç§å¯¹åº”å…³ç³»ï¼Œå¦‚ä¸‹å›¾ã€‚ æŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ã€Œä¾èµ–æ”¶é›†ã€æ˜¯å¦‚ä½•å®žçŽ°çš„ã€‚ è®¢é˜…è€… Depé¦–å…ˆæˆ‘ä»¬æ¥å®žçŽ°ä¸€ä¸ªè®¢é˜…è€… Dep ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜æ”¾ Watcher è§‚å¯Ÿè€…å¯¹è±¡ã€‚ 123456789101112131415161718class Dep &#123; constructor () &#123; /* ç”¨æ¥å­˜æ”¾Watcherå¯¹è±¡çš„æ•°ç»„ */ this.subs = []; &#125; /* åœ¨subsä¸­æ·»åŠ ä¸€ä¸ªWatcherå¯¹è±¡ */ addSub (sub) &#123; this.subs.push(sub); &#125; /* é€šçŸ¥æ‰€æœ‰Watcherå¯¹è±¡æ›´æ–°è§†å›¾ */ notify () &#123; this.subs.forEach((sub) =&gt; &#123; sub.update(); &#125;) &#125;&#125; ä¸ºäº†ä¾¿äºŽç†è§£æˆ‘ä»¬åªå®žçŽ°äº†æ·»åŠ çš„éƒ¨åˆ†ä»£ç ï¼Œä¸»è¦æ˜¯ä¸¤ä»¶äº‹æƒ…ï¼š ç”¨ addSub æ–¹æ³•å¯ä»¥åœ¨ç›®å‰çš„ Dep å¯¹è±¡ä¸­å¢žåŠ ä¸€ä¸ª Watcher çš„è®¢é˜…æ“ä½œï¼› ç”¨ notify æ–¹æ³•é€šçŸ¥ç›®å‰ Dep å¯¹è±¡çš„ subs ä¸­çš„æ‰€æœ‰ Watcher å¯¹è±¡è§¦å‘æ›´æ–°æ“ä½œã€‚ è§‚å¯Ÿè€… Watcher12345678910111213class Watcher &#123; constructor () &#123; /* åœ¨newä¸€ä¸ªWatcherå¯¹è±¡æ—¶å°†è¯¥å¯¹è±¡èµ‹å€¼ç»™Dep.targetï¼Œåœ¨getä¸­ä¼šç”¨åˆ° */ Dep.target = this; &#125; /* æ›´æ–°è§†å›¾çš„æ–¹æ³• */ update () &#123; console.log(&quot;è§†å›¾æ›´æ–°å•¦ï½ž&quot;); &#125;&#125;Dep.target = null; ä¾èµ–æ”¶é›†æŽ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ defineReactive ä»¥åŠ Vue çš„æž„é€ å‡½æ•°ï¼Œæ¥å®Œæˆä¾èµ–æ”¶é›†ã€‚ æˆ‘ä»¬åœ¨é—­åŒ…ä¸­å¢žåŠ äº†ä¸€ä¸ª Dep ç±»çš„å¯¹è±¡ï¼Œç”¨æ¥æ”¶é›† Watcher å¯¹è±¡ã€‚åœ¨å¯¹è±¡è¢«ã€Œè¯»ã€çš„æ—¶å€™ï¼Œä¼šè§¦å‘ reactiveGetter å‡½æ•°æŠŠå½“å‰çš„ Watcher å¯¹è±¡ï¼ˆå­˜æ”¾åœ¨ Dep.target ä¸­ï¼‰æ”¶é›†åˆ° Dep ç±»ä¸­åŽ»ã€‚ä¹‹åŽå¦‚æžœå½“è¯¥å¯¹è±¡è¢«ã€Œå†™ã€çš„æ—¶å€™ï¼Œåˆ™ä¼šè§¦å‘ reactiveSetter æ–¹æ³•ï¼Œé€šçŸ¥ Dep ç±»è°ƒç”¨ notify æ¥è§¦å‘æ‰€æœ‰ Watcher å¯¹è±¡çš„ update æ–¹æ³•æ›´æ–°å¯¹åº”è§†å›¾ã€‚ 123456789101112131415161718192021222324252627282930function defineReactive (obj, key, val) &#123; /* ä¸€ä¸ªDepç±»å¯¹è±¡ */ const dep = new Dep(); Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter () &#123; /* å°†Dep.targetï¼ˆå³å½“å‰çš„Watcherå¯¹è±¡å­˜å…¥depçš„subsä¸­ï¼‰ */ dep.addSub(Dep.target); return val; &#125;, set: function reactiveSetter (newVal) &#123; if (newVal === val) return; /* åœ¨setçš„æ—¶å€™è§¦å‘depçš„notifyæ¥é€šçŸ¥æ‰€æœ‰çš„Watcherå¯¹è±¡æ›´æ–°è§†å›¾ */ dep.notify(); &#125; &#125;);&#125;class Vue &#123; constructor(options) &#123; this._data = options.data; observer(this._data); /* æ–°å»ºä¸€ä¸ªWatcherè§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¿™æ—¶å€™Dep.targetä¼šæŒ‡å‘è¿™ä¸ªWatcherå¯¹è±¡ */ new Watcher(); /* åœ¨è¿™é‡Œæ¨¡æ‹Ÿrenderçš„è¿‡ç¨‹ï¼Œä¸ºäº†è§¦å‘testå±žæ€§çš„getå‡½æ•° */ console.log(&apos;render~&apos;, this._data.test); &#125;&#125; å°ç»“æ€»ç»“ä¸€ä¸‹ã€‚ é¦–å…ˆåœ¨ observer çš„è¿‡ç¨‹ä¸­ä¼šæ³¨å†Œ get æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è¿›è¡Œã€Œä¾èµ–æ”¶é›†ã€ã€‚åœ¨å®ƒçš„é—­åŒ…ä¸­ä¼šæœ‰ä¸€ä¸ª Dep å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨æ¥å­˜æ”¾ Watcher å¯¹è±¡çš„å®žä¾‹ã€‚å…¶å®žã€Œä¾èµ–æ”¶é›†ã€çš„è¿‡ç¨‹å°±æ˜¯æŠŠ Watcher å®žä¾‹å­˜æ”¾åˆ°å¯¹åº”çš„ Dep å¯¹è±¡ä¸­åŽ»ã€‚get æ–¹æ³•å¯ä»¥è®©å½“å‰çš„ Watcher å¯¹è±¡ï¼ˆDep.targetï¼‰å­˜æ”¾åˆ°å®ƒçš„ subs ä¸­ï¼ˆaddSubï¼‰æ–¹æ³•ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶ï¼Œset ä¼šè°ƒç”¨ Dep å¯¹è±¡çš„ notify æ–¹æ³•é€šçŸ¥å®ƒå†…éƒ¨æ‰€æœ‰çš„ Watcher å¯¹è±¡è¿›è¡Œè§†å›¾æ›´æ–°ã€‚ è¿™æ˜¯ Object.defineProperty çš„ set/get æ–¹æ³•å¤„ç†çš„äº‹æƒ…ï¼Œé‚£ä¹ˆã€Œä¾èµ–æ”¶é›†ã€çš„å‰ææ¡ä»¶è¿˜æœ‰ä¸¤ä¸ªï¼š è§¦å‘ get æ–¹æ³•ï¼› æ–°å»ºä¸€ä¸ª Watcher å¯¹è±¡ã€‚ è¿™ä¸ªæˆ‘ä»¬åœ¨ Vue çš„æž„é€ ç±»ä¸­å¤„ç†ã€‚æ–°å»ºä¸€ä¸ª Watcher å¯¹è±¡åªéœ€è¦ new å‡ºæ¥ï¼Œè¿™æ—¶å€™ Dep.target å·²ç»æŒ‡å‘äº†è¿™ä¸ª new å‡ºæ¥çš„ Watcher å¯¹è±¡æ¥ã€‚è€Œè§¦å‘ get æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå®žé™…ä¸Šåªè¦æŠŠ render function è¿›è¡Œæ¸²æŸ“ï¼Œé‚£ä¹ˆå…¶ä¸­çš„ä¾èµ–çš„å¯¹è±¡éƒ½ä¼šè¢«ã€Œè¯»å–ã€ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡æ‰“å°æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œè¯»å– test æ¥è§¦å‘ get è¿›è¡Œã€Œä¾èµ–æ”¶é›†ã€ã€‚ æœ¬ç« æˆ‘ä»¬ä»‹ç»äº†ã€Œä¾èµ–æ”¶é›†ã€çš„è¿‡ç¨‹ï¼Œé…åˆä¹‹å‰çš„å“åº”å¼åŽŸç†ï¼Œå·²ç»æŠŠæ•´ä¸ªã€Œå“åº”å¼ç³»ç»Ÿã€ä»‹ç»å®Œæ¯•äº†ã€‚å…¶ä¸»è¦å°±æ˜¯ get è¿›è¡Œã€Œä¾èµ–æ”¶é›†ã€ã€‚set é€šè¿‡è§‚å¯Ÿè€…æ¥æ›´æ–°è§†å›¾ï¼Œé…åˆä¸‹å›¾ä»”ç»†æ‹ä¸€æ‹ï¼Œç›¸ä¿¡ä¸€å®šèƒ½æžæ‡‚å®ƒï¼ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Šå“åº”å¼ç³»ç»Ÿçš„ä¾èµ–æ”¶é›†è¿½è¸ªåŽŸç†ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å“åº”å¼ç³»ç»Ÿçš„åŸºæœ¬åŽŸç†]]></title>
    <url>%2F2018%2F09%2F14%2F%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[å“åº”å¼ç³»ç»ŸVue.js æ˜¯ä¸€æ¬¾ MVVM æ¡†æž¶ï¼Œæ•°æ®æ¨¡åž‹ä»…ä»…æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œä½†æ˜¯å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå´èƒ½å½±å“å¯¹åº”è§†å›¾ï¼Œå®ƒçš„æ ¸å¿ƒå®žçŽ°å°±æ˜¯ã€Œå“åº”å¼ç³»ç»Ÿã€ã€‚å°½ç®¡æˆ‘ä»¬åœ¨ä½¿ç”¨ Vue.js è¿›è¡Œå¼€å‘æ—¶ä¸ä¼šç›´æŽ¥ä¿®æ”¹ã€Œå“åº”å¼ç³»ç»Ÿã€ï¼Œä½†æ˜¯ç†è§£å®ƒçš„å®žçŽ°æœ‰åŠ©äºŽé¿å¼€ä¸€äº›å¸¸è§çš„ã€Œå‘ã€ï¼Œä¹Ÿæœ‰åŠ©äºŽåœ¨é‡è§ä¸€äº›ç¢ç£¨ä¸é€çš„é—®é¢˜æ—¶å¯ä»¥æ·±å…¥å…¶åŽŸç†æ¥è§£å†³å®ƒã€‚ Object.definePropertyé¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ Object.definePropertyï¼ŒVue.jså°±æ˜¯åŸºäºŽå®ƒå®žçŽ°ã€Œå“åº”å¼ç³»ç»Ÿã€çš„ã€‚ é¦–å…ˆæ˜¯ä½¿ç”¨æ–¹æ³•ï¼š 12345678/* obj: ç›®æ ‡å¯¹è±¡ prop: éœ€è¦æ“ä½œçš„ç›®æ ‡å¯¹è±¡çš„å±žæ€§å descriptor: æè¿°ç¬¦ return value ä¼ å…¥å¯¹è±¡*/Object.defineProperty(obj, prop, descriptor) descriptorçš„ä¸€äº›å±žæ€§ï¼Œç®€å•ä»‹ç»å‡ ä¸ªå±žæ€§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ MDN æ–‡æ¡£ã€‚ enumerableï¼Œå±žæ€§æ˜¯å¦å¯æžšä¸¾ï¼Œé»˜è®¤ falseã€‚ configurableï¼Œå±žæ€§æ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹æˆ–è€…åˆ é™¤ï¼Œé»˜è®¤ falseã€‚ getï¼ŒèŽ·å–å±žæ€§çš„æ–¹æ³•ã€‚ setï¼Œè®¾ç½®å±žæ€§çš„æ–¹æ³•ã€‚ å®žçŽ° observerï¼ˆå¯è§‚å¯Ÿçš„ï¼‰çŸ¥é“äº† Object.defineProperty ä»¥åŽï¼Œæˆ‘ä»¬æ¥ç”¨å®ƒä½¿å¯¹è±¡å˜æˆå¯è§‚å¯Ÿçš„ã€‚ è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹æˆ‘ä»¬åœ¨ç¬¬äºŒå°èŠ‚ä¸­å·²ç»åˆæ­¥ä»‹ç»è¿‡ï¼Œåœ¨ init çš„é˜¶æ®µä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹æ•°æ®è¿›è¡Œã€Œå“åº”å¼åŒ–ã€ã€‚ ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘æ•°ç»„ç­‰å¤æ‚çš„æƒ…å†µï¼Œåªå¯¹å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª cb å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥æ¨¡æ‹Ÿè§†å›¾æ›´æ–°ï¼Œè°ƒç”¨å®ƒå³ä»£è¡¨æ›´æ–°è§†å›¾ï¼Œå†…éƒ¨å¯ä»¥æ˜¯ä¸€äº›æ›´æ–°è§†å›¾çš„æ–¹æ³•ã€‚ 1234function cb (val) &#123; /* æ¸²æŸ“è§†å›¾ */ console.log(&quot;è§†å›¾æ›´æ–°å•¦ï½ž&quot;);&#125; ç„¶åŽæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª defineReactive ï¼Œè¿™ä¸ªæ–¹æ³•é€šè¿‡ Object.defineProperty æ¥å®žçŽ°å¯¹å¯¹è±¡çš„ã€Œå“åº”å¼ã€åŒ–ï¼Œå…¥å‚æ˜¯ä¸€ä¸ª objï¼ˆéœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼‰ã€keyï¼ˆobjçš„æŸä¸€ä¸ªå±žæ€§ï¼‰ï¼Œvalï¼ˆå…·ä½“çš„å€¼ï¼‰ã€‚ç»è¿‡ defineReactive å¤„ç†ä»¥åŽï¼Œæˆ‘ä»¬çš„ obj çš„ key å±žæ€§åœ¨ã€Œè¯»ã€çš„æ—¶å€™ä¼šè§¦å‘ reactiveGetter æ–¹æ³•ï¼Œè€Œåœ¨è¯¥å±žæ€§è¢«ã€Œå†™ã€çš„æ—¶å€™åˆ™ä¼šè§¦å‘ reactiveSetter æ–¹æ³•ã€‚ 12345678910111213function defineReactive (obj, key, val) &#123; Object.defineProperty(obj, key, &#123; enumerable: true, /* å±žæ€§å¯æžšä¸¾ */ configurable: true, /* å±žæ€§å¯è¢«ä¿®æ”¹æˆ–åˆ é™¤ */ get: function reactiveGetter () &#123; return val; /* å®žé™…ä¸Šä¼šä¾èµ–æ”¶é›†ï¼Œä¸‹ä¸€å°èŠ‚ä¼šè®² */ &#125;, set: function reactiveSetter (newVal) &#123; if (newVal === val) return; cb(newVal); &#125; &#125;);&#125; å½“ç„¶è¿™æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸Šé¢å†å°è£…ä¸€å±‚ observer ã€‚è¿™ä¸ªå‡½æ•°ä¼ å…¥ä¸€ä¸ª valueï¼ˆéœ€è¦ã€Œå“åº”å¼ã€åŒ–çš„å¯¹è±¡ï¼‰ï¼Œé€šè¿‡éåŽ†æ‰€æœ‰å±žæ€§çš„æ–¹å¼å¯¹è¯¥å¯¹è±¡çš„æ¯ä¸€ä¸ªå±žæ€§éƒ½é€šè¿‡ defineReactive å¤„ç†ã€‚ï¼ˆæ³¨ï¼šå®žé™…ä¸Š observer ä¼šè¿›è¡Œé€’å½’è°ƒç”¨ï¼Œä¸ºäº†ä¾¿äºŽç†è§£åŽ»æŽ‰äº†é€’å½’çš„è¿‡ç¨‹ï¼‰ 123456789function observer (value) &#123; if (!value || (typeof value !== &apos;object&apos;)) &#123; return; &#125; Object.keys(value).forEach((key) =&gt; &#123; defineReactive(value, key, value[key]); &#125;);&#125; æœ€åŽï¼Œè®©æˆ‘ä»¬ç”¨ observer æ¥å°è£…ä¸€ä¸ª Vue å§ï¼ åœ¨ Vue çš„æž„é€ å‡½æ•°ä¸­ï¼Œå¯¹ options çš„ data è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œçš„ data æƒ³å¿…å¤§å®¶å¾ˆç†Ÿæ‚‰ï¼Œå°±æ˜¯å¹³æ—¶æˆ‘ä»¬åœ¨å†™ Vue é¡¹ç›®æ—¶ç»„ä»¶ä¸­çš„ data å±žæ€§ï¼ˆå®žé™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå½“ä½œä¸€ä¸ªå¯¹è±¡æ¥ç®€å•å¤„ç†ï¼‰ã€‚ 1234567class Vue &#123; /* Vueæž„é€ ç±» */ constructor(options) &#123; this._data = options.data; observer(this._data); &#125;&#125; è¿™æ ·æˆ‘ä»¬åªè¦ new ä¸€ä¸ª Vue å¯¹è±¡ï¼Œå°±ä¼šå°† data ä¸­çš„æ•°æ®è¿›è¡Œã€Œå“åº”å¼ã€åŒ–ã€‚å¦‚æžœæˆ‘ä»¬å¯¹ data çš„å±žæ€§è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼Œå°±ä¼šè§¦å‘ cb æ–¹æ³•æ›´æ–°è§†å›¾ã€‚ 123456let o = new Vue(&#123; data: &#123; test: &quot;I am test.&quot; &#125;&#125;);o._data.test = &quot;hello,world.&quot;; /* è§†å›¾æ›´æ–°å•¦ï½ž */ è‡³æ­¤ï¼Œå“åº”å¼åŽŸç†å·²ç»ä»‹ç»å®Œäº†ï¼ŒæŽ¥ä¸‹æ¥è®©æˆ‘ä»¬å­¦ä¹ ã€Œå“åº”å¼ç³»ç»Ÿã€çš„å¦ä¸€éƒ¨åˆ† â€”â€”ã€Œä¾èµ–æ”¶é›†ã€ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Šå“åº”å¼ç³»ç»Ÿçš„åŸºæœ¬åŽŸç†ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®çŠ¶æ€æ›´æ–°æ—¶çš„å·®å¼‚ diff åŠ patch æœºåˆ¶]]></title>
    <url>%2F2018%2F09%2F09%2F%E6%95%B0%E6%8D%AE%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0%E6%97%B6%E7%9A%84%E5%B7%AE%E5%BC%82%20diff%20%E5%8F%8A%20patch%20%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[æ•°æ®æ›´æ–°è§†å›¾ä¹‹å‰è®²åˆ°ï¼Œåœ¨å¯¹ model è¿›è¡Œæ“ä½œå¯¹æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº” Dep ä¸­çš„ Watcher å¯¹è±¡ã€‚Watcher å¯¹è±¡ä¼šè°ƒç”¨å¯¹åº”çš„ update æ¥ä¿®æ”¹è§†å›¾ã€‚æœ€ç»ˆæ˜¯å°†æ–°äº§ç”Ÿçš„ VNode èŠ‚ç‚¹ä¸Žè€ VNode è¿›è¡Œä¸€ä¸ª patch çš„è¿‡ç¨‹ï¼Œæ¯”å¯¹å¾—å‡ºã€Œå·®å¼‚ã€ï¼Œæœ€ç»ˆå°†è¿™äº›ã€Œå·®å¼‚ã€æ›´æ–°åˆ°è§†å›¾ä¸Šã€‚ è¿™ä¸€ç« å°±æ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸ª patch çš„è¿‡ç¨‹ï¼Œå› ä¸º patch è¿‡ç¨‹æœ¬èº«æ¯”è¾ƒå¤æ‚ï¼Œè¿™ä¸€ç« çš„å†…å®¹ä¼šæ¯”è¾ƒå¤šï¼Œä½†æ˜¯ä¸è¦å®³æ€•ï¼Œæˆ‘ä»¬é€å—ä»£ç åŽ»çœ‹ï¼Œä¸€å®šå¯ä»¥ç†è§£ã€‚ è·¨å¹³å°å› ä¸ºä½¿ç”¨äº† Virtual DOM çš„åŽŸå› ï¼ŒVue.jså…·æœ‰äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼ŒVirtual DOM ç»ˆå½’åªæ˜¯ä¸€äº› JavaScript å¯¹è±¡ç½¢äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆæ˜¯å¦‚ä½•è°ƒç”¨ä¸åŒå¹³å°çš„ API çš„å‘¢ï¼Ÿ è¿™å°±éœ€è¦ä¾èµ–ä¸€å±‚é€‚é…å±‚äº†ï¼Œå°†ä¸åŒå¹³å°çš„ API å°è£…åœ¨å†…ï¼Œä»¥åŒæ ·çš„æŽ¥å£å¯¹å¤–æä¾›ã€‚ 123456789101112131415161718192021const nodeOps = &#123; setTextContent (text) &#123; if (platform === &apos;weex&apos;) &#123; node.parentNode.setAttr(&apos;value&apos;, text); &#125; else if (platform === &apos;web&apos;) &#123; node.textContent = text; &#125; &#125;, parentNode () &#123; //...... &#125;, removeChild () &#123; //...... &#125;, nextSibling () &#123; //...... &#125;, insertBefore () &#123; //...... &#125;&#125; ä¸¾ä¸ªä¾‹å­ï¼ŒçŽ°åœ¨æˆ‘ä»¬æœ‰ä¸Šè¿°ä¸€ä¸ª nodeOps å¯¹è±¡åšé€‚é…ï¼Œæ ¹æ® platform åŒºåˆ†ä¸åŒå¹³å°æ¥æ‰§è¡Œå½“å‰å¹³å°å¯¹åº”çš„APIï¼Œè€Œå¯¹å¤–åˆ™æ˜¯æä¾›äº†ä¸€è‡´çš„æŽ¥å£ï¼Œä¾› Virtual DOM æ¥è°ƒç”¨ã€‚ ä¸€äº›APIæŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä»‹ç»å…¶ä»–çš„ä¸€äº› APIï¼Œè¿™äº›APIåœ¨ä¸‹é¢ patch çš„è¿‡ç¨‹ä¸­ä¼šè¢«ç”¨åˆ°ï¼Œä»–ä»¬æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ nodeOps ä¸­çš„ç›¸åº”å‡½æ•°æ¥æ“ä½œå¹³å°ã€‚ insert ç”¨æ¥åœ¨ parent è¿™ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹æ’å…¥ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚æžœæŒ‡å®šäº† ref åˆ™æ’å…¥åˆ° ref è¿™ä¸ªå­èŠ‚ç‚¹å‰é¢ã€‚ 1234567891011function insert (parent, elm, ref) &#123; if (parent) &#123; if (ref) &#123; if (ref.parentNode === parent) &#123; nodeOps.insertBefore(parent, elm, ref); &#125; &#125; else &#123; nodeOps.appendChild(parent, elm) &#125; &#125;&#125; createElm ç”¨æ¥æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œ tag å­˜åœ¨åˆ›å»ºä¸€ä¸ªæ ‡ç­¾èŠ‚ç‚¹ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚ 12345678function createElm (vnode, parentElm, refElm) &#123; if (vnode.tag) &#123; insert(parentElm, nodeOps.createElement(vnode.tag), refElm); &#125; else &#123; insert(parentElm, nodeOps.createTextNode(vnode.text), refElm); &#125;&#125; addVnodes ç”¨æ¥æ‰¹é‡è°ƒç”¨ createElm æ–°å»ºèŠ‚ç‚¹ã€‚ 12345function addVnodes (parentElm, refElm, vnodes, startIdx, endIdx) &#123; for (; startIdx &lt;= endIdx; ++startIdx) &#123; createElm(vnodes[startIdx], parentElm, refElm); &#125;&#125; removeNode ç”¨æ¥ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 123456function removeNode (el) &#123; const parent = nodeOps.parentNode(el); if (parent) &#123; nodeOps.removeChild(parent, el); &#125;&#125; removeVnodes ä¼šæ‰¹é‡è°ƒç”¨ removeNode ç§»é™¤èŠ‚ç‚¹ã€‚ 12345678function removeVnodes (parentElm, vnodes, startIdx, endIdx) &#123; for (; startIdx &lt;= endIdx; ++startIdx) &#123; const ch = vnodes[startIdx] if (ch) &#123; removeNode(ch.elm); &#125; &#125;&#125; patché¦–å…ˆè¯´ä¸€ä¸‹ patch çš„æ ¸å¿ƒ diff ç®—æ³•ï¼Œæˆ‘ä»¬ç”¨ diff ç®—æ³•å¯ä»¥æ¯”å¯¹å‡ºä¸¤é¢—æ ‘çš„ã€Œå·®å¼‚ã€ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬çŽ°åœ¨æœ‰å¦‚ä¸‹ä¸¤é¢—æ ‘ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æ–°è€ VNode èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™åˆ°äº† patch çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–ä»¬è¿›è¡Œæ¯”å¯¹ã€‚ diff ç®—æ³•æ˜¯é€šè¿‡åŒå±‚çš„æ ‘èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒè€Œéžå¯¹æ ‘è¿›è¡Œé€å±‚æœç´¢éåŽ†çš„æ–¹å¼ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦åªæœ‰ O(n)ï¼Œæ˜¯ä¸€ç§ç›¸å½“é«˜æ•ˆçš„ç®—æ³•ï¼Œå¦‚ä¸‹å›¾ã€‚ ã€‚ è¿™å¼ å›¾ä¸­çš„ç›¸åŒé¢œè‰²çš„æ–¹å—ä¸­çš„èŠ‚ç‚¹ä¼šè¿›è¡Œæ¯”å¯¹ï¼Œæ¯”å¯¹å¾—åˆ°ã€Œå·®å¼‚ã€åŽå°†è¿™äº›ã€Œå·®å¼‚ã€æ›´æ–°åˆ°è§†å›¾ä¸Šã€‚å› ä¸ºåªè¿›è¡ŒåŒå±‚çº§çš„æ¯”å¯¹ï¼Œæ‰€ä»¥ååˆ†é«˜æ•ˆã€‚ patch çš„è¿‡ç¨‹ç›¸å½“å¤æ‚ï¼Œæˆ‘ä»¬å…ˆç”¨ç®€å•çš„ä»£ç æ¥çœ‹ä¸€ä¸‹ã€‚ 1234567891011121314function patch (oldVnode, vnode, parentElm) &#123; if (!oldVnode) &#123; addVnodes(parentElm, null, vnode, 0, vnode.length - 1); &#125; else if (!vnode) &#123; removeVnodes(parentElm, oldVnode, 0, oldVnode.length - 1); &#125; else &#123; if (sameVnode(oldVNode, vnode)) &#123; patchVnode(oldVNode, vnode); &#125; else &#123; removeVnodes(parentElm, oldVnode, 0, oldVnode.length - 1); addVnodes(parentElm, null, vnode, 0, vnode.length - 1); &#125; &#125;&#125; å› ä¸º patch çš„ä¸»è¦åŠŸèƒ½æ˜¯æ¯”å¯¹ä¸¤ä¸ª VNode èŠ‚ç‚¹ï¼Œå°†ã€Œå·®å¼‚ã€æ›´æ–°åˆ°è§†å›¾ä¸Šï¼Œæ‰€ä»¥å…¥å‚æœ‰æ–°è€ä¸¤ä¸ª VNode ä»¥åŠçˆ¶èŠ‚ç‚¹çš„ element ã€‚æˆ‘ä»¬æ¥é€æ­¥æ‹ä¸€ä¸‹é€»è¾‘ï¼Œ addVnodes ã€ removeVnodes ç­‰å‡½æ•°åŽé¢ä¼šè®²ã€‚ é¦–å…ˆåœ¨ oldVnodeï¼ˆè€ VNode èŠ‚ç‚¹ï¼‰ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œç›¸å½“äºŽæ–°çš„ VNode æ›¿ä»£åŽŸæœ¬æ²¡æœ‰çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç›´æŽ¥ç”¨ addVnodes å°†è¿™äº›èŠ‚ç‚¹æ‰¹é‡æ·»åŠ åˆ° parentElm ä¸Šã€‚ 123if (!oldVnode) &#123; addVnodes(parentElm, null, vnode, 0, vnode.length - 1);&#125; ç„¶åŽåŒç†ï¼Œåœ¨ vnodeï¼ˆæ–° VNode èŠ‚ç‚¹ï¼‰ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œç›¸å½“äºŽè¦æŠŠè€çš„èŠ‚ç‚¹åˆ é™¤ï¼Œæ‰€ä»¥ç›´æŽ¥ä½¿ç”¨ removeVnodes è¿›è¡Œæ‰¹é‡çš„èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚ 123else if (!vnode) &#123; removeVnodes(parentElm, oldVnode, 0, oldVnode.length - 1);&#125; æœ€åŽä¸€ç§æƒ…å†µï¼Œå½“ oldVNode ä¸Ž vnode éƒ½å­˜åœ¨çš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­å®ƒä»¬æ˜¯å¦å±žäºŽ sameVnodeï¼ˆç›¸åŒçš„èŠ‚ç‚¹ï¼‰ã€‚å¦‚æžœæ˜¯åˆ™è¿›è¡ŒpatchVnodeï¼ˆæ¯”å¯¹ VNode ï¼‰æ“ä½œï¼Œå¦åˆ™åˆ é™¤è€èŠ‚ç‚¹ï¼Œå¢žåŠ æ–°èŠ‚ç‚¹ã€‚ 123456if (sameVnode(oldVNode, vnode)) &#123; patchVnode(oldVNode, vnode);&#125; else &#123; removeVnodes(parentElm, oldVnode, 0, oldVnode.length - 1); addVnodes(parentElm, null, vnode, 0, vnode.length - 1);&#125; sameVnodeä¸Šé¢è¿™äº›æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹ä¸¤ä¸ª VNode ä¼šå±žäºŽ sameVnode ï¼ˆç›¸åŒçš„èŠ‚ç‚¹ï¼‰å‘¢ï¼Ÿ 1234567891011121314151617function sameVnode () &#123; return ( a.key === b.key &amp;&amp; a.tag === b.tag &amp;&amp; a.isComment === b.isComment &amp;&amp; (!!a.data) === (!!b.data) &amp;&amp; sameInputType(a, b) )&#125;function sameInputType (a, b) &#123; if (a.tag !== &apos;input&apos;) return true let i const typeA = (i = a.data) &amp;&amp; (i = i.attrs) &amp;&amp; i.type const typeB = (i = b.data) &amp;&amp; (i = i.attrs) &amp;&amp; i.type return typeA === typeB&#125; sameVnode å…¶å®žå¾ˆç®€å•ï¼Œåªæœ‰å½“ keyã€ tagã€ isCommentï¼ˆæ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹ï¼‰ã€ dataåŒæ—¶å®šä¹‰ï¼ˆæˆ–ä¸å®šä¹‰ï¼‰ï¼ŒåŒæ—¶æ»¡è¶³å½“æ ‡ç­¾ç±»åž‹ä¸º input çš„æ—¶å€™ type ç›¸åŒï¼ˆæŸäº›æµè§ˆå™¨ä¸æ”¯æŒåŠ¨æ€ä¿®æ”¹ç±»åž‹ï¼Œæ‰€ä»¥ä»–ä»¬è¢«è§†ä¸ºä¸åŒç±»åž‹ï¼‰å³å¯ã€‚ patchVnodeä¹‹å‰patchçš„è¿‡ç¨‹è¿˜å‰©ä¸‹ patchVnode è¿™ä¸ªå‡½æ•°æ²¡æœ‰è®²ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬çŽ°åœ¨æ¥çœ‹ä¸€ä¸‹ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯åœ¨ç¬¦åˆ sameVnode çš„æ¡ä»¶ä¸‹è§¦å‘çš„ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œã€Œæ¯”å¯¹ã€ã€‚ 123456789101112131415161718192021222324252627282930function patchVnode (oldVnode, vnode) &#123; if (oldVnode === vnode) &#123; return; &#125; if (vnode.isStatic &amp;&amp; oldVnode.isStatic &amp;&amp; vnode.key === oldVnode.key) &#123; vnode.elm = oldVnode.elm; vnode.componentInstance = oldVnode.componentInstance; return; &#125; const elm = vnode.elm = oldVnode.elm; const oldCh = oldVnode.children; const ch = vnode.children; if (vnode.text) &#123; nodeOps.setTextContent(elm, vnode.text); &#125; else &#123; if (oldCh &amp;&amp; ch &amp;&amp; (oldCh !== ch)) &#123; updateChildren(elm, oldCh, ch); &#125; else if (ch) &#123; if (oldVnode.text) nodeOps.setTextContent(elm, &apos;&apos;); addVnodes(elm, null, ch, 0, ch.length - 1); &#125; else if (oldCh) &#123; removeVnodes(elm, oldCh, 0, oldCh.length - 1) &#125; else if (oldVnode.text) &#123; nodeOps.setTextContent(elm, &apos;&apos;) &#125; &#125;&#125; é¦–å…ˆåœ¨æ–°è€ VNode èŠ‚ç‚¹ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå°±ä¸éœ€è¦åšä»»ä½•æ”¹å˜äº†ï¼Œç›´æŽ¥ return æŽ‰ã€‚ 123if (oldVnode === vnode) &#123; return;&#125; ä¸‹é¢çš„è¿™ç§æƒ…å†µä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨å½“æ–°è€ VNode èŠ‚ç‚¹éƒ½æ˜¯ isStaticï¼ˆé™æ€çš„ï¼‰ï¼Œå¹¶ä¸” key ç›¸åŒæ—¶ï¼Œåªè¦å°† componentInstance ä¸Ž elm ä»Žè€ VNode èŠ‚ç‚¹â€œæ‹¿è¿‡æ¥â€å³å¯ã€‚è¿™é‡Œçš„ isStatic ä¹Ÿå°±æ˜¯å‰é¢æåˆ°è¿‡çš„ã€Œç¼–è¯‘ã€çš„æ—¶å€™ä¼šå°†é™æ€èŠ‚ç‚¹æ ‡è®°å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡æ¯”å¯¹çš„è¿‡ç¨‹ã€‚ 12345if (vnode.isStatic &amp;&amp; oldVnode.isStatic &amp;&amp; vnode.key === oldVnode.key) &#123; vnode.elm = oldVnode.elm; vnode.componentInstance = oldVnode.componentInstance; return;&#125; æŽ¥ä¸‹æ¥ï¼Œå½“æ–° VNode èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç›´æŽ¥ç”¨ setTextContent æ¥è®¾ç½® textï¼Œè¿™é‡Œçš„ nodeOps æ˜¯ä¸€ä¸ªé€‚é…å±‚ï¼Œæ ¹æ®ä¸åŒå¹³å°æä¾›ä¸åŒçš„æ“ä½œå¹³å° DOM çš„æ–¹æ³•ï¼Œå®žçŽ°è·¨å¹³å°ã€‚ 123if (vnode.text) &#123; nodeOps.setTextContent(elm, vnode.text);&#125; å½“æ–° VNode èŠ‚ç‚¹æ˜¯éžæ–‡æœ¬èŠ‚ç‚¹å½“æ—¶å€™ï¼Œéœ€è¦åˆ†å‡ ç§æƒ…å†µã€‚ oldCh ä¸Ž ch éƒ½å­˜åœ¨ä¸”ä¸ç›¸åŒæ—¶ï¼Œä½¿ç”¨ updateChildren å‡½æ•°æ¥æ›´æ–°å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªåŽé¢é‡ç‚¹è®²ã€‚ å¦‚æžœåªæœ‰ ch å­˜åœ¨çš„æ—¶å€™ï¼Œå¦‚æžœè€èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹åˆ™å…ˆå°†èŠ‚ç‚¹çš„æ–‡æœ¬æ¸…é™¤ï¼Œç„¶åŽå°† ch æ‰¹é‡æ’å…¥æ’å…¥åˆ°èŠ‚ç‚¹elmä¸‹ã€‚ åŒç†å½“åªæœ‰ oldch å­˜åœ¨æ—¶ï¼Œè¯´æ˜Žéœ€è¦å°†è€èŠ‚ç‚¹é€šè¿‡ removeVnodes å…¨éƒ¨æ¸…é™¤ã€‚ æœ€åŽä¸€ç§æƒ…å†µæ˜¯å½“åªæœ‰è€èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ¸…é™¤å…¶èŠ‚ç‚¹æ–‡æœ¬å†…å®¹ã€‚ 12345678910if (oldCh &amp;&amp; ch &amp;&amp; (oldCh !== ch)) &#123; updateChildren(elm, oldCh, ch);&#125; else if (ch) &#123; if (oldVnode.text) nodeOps.setTextContent(elm, &apos;&apos;); addVnodes(elm, null, ch, 0, ch.length - 1);&#125; else if (oldCh) &#123; removeVnodes(elm, oldCh, 0, oldCh.length - 1)&#125; else if (oldVnode.text) &#123; nodeOps.setTextContent(elm, &apos;&apos;)&#125; updateChildrenæŽ¥ä¸‹æ¥å°±è¦è®²ä¸€ä¸‹ updateChildren å‡½æ•°äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263function updateChildren (parentElm, oldCh, newCh) &#123; let oldStartIdx = 0; let newStartIdx = 0; let oldEndIdx = oldCh.length - 1; let oldStartVnode = oldCh[0]; let oldEndVnode = oldCh[oldEndIdx]; let newEndIdx = newCh.length - 1; let newStartVnode = newCh[0]; let newEndVnode = newCh[newEndIdx]; let oldKeyToIdx, idxInOld, elmToMove, refElm; while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123; if (!oldStartVnode) &#123; oldStartVnode = oldCh[++oldStartIdx]; &#125; else if (!oldEndVnode) &#123; oldEndVnode = oldCh[--oldEndIdx]; &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123; patchVnode(oldStartVnode, newStartVnode); oldStartVnode = oldCh[++oldStartIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123; patchVnode(oldEndVnode, newEndVnode); oldEndVnode = oldCh[--oldEndIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; patchVnode(oldStartVnode, newEndVnode); nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm)); oldStartVnode = oldCh[++oldStartIdx]; newEndVnode = newCh[--newEndIdx]; &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; patchVnode(oldEndVnode, newStartVnode); nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm); oldEndVnode = oldCh[--oldEndIdx]; newStartVnode = newCh[++newStartIdx]; &#125; else &#123; let elmToMove = oldCh[idxInOld]; if (!oldKeyToIdx) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx); idxInOld = newStartVnode.key ? oldKeyToIdx[newStartVnode.key] : null; if (!idxInOld) &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx]; &#125; else &#123; elmToMove = oldCh[idxInOld]; if (sameVnode(elmToMove, newStartVnode)) &#123; patchVnode(elmToMove, newStartVnode); oldCh[idxInOld] = undefined; nodeOps.insertBefore(parentElm, newStartVnode.elm, oldStartVnode.elm); newStartVnode = newCh[++newStartIdx]; &#125; else &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx]; &#125; &#125; &#125; &#125; if (oldStartIdx &gt; oldEndIdx) &#123; refElm = (newCh[newEndIdx + 1]) ? newCh[newEndIdx + 1].elm : null; addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx); &#125; else if (newStartIdx &gt; newEndIdx) &#123; removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx); &#125;&#125; çœ‹åˆ°ä»£ç é‚£ä¹ˆå¤šå…ˆä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸€ç‚¹ä¸€ç‚¹åœ°è®²è§£ã€‚ é¦–å…ˆæˆ‘ä»¬å®šä¹‰ oldStartIdxã€newStartIdxã€oldEndIdx ä»¥åŠ newEndIdx åˆ†åˆ«æ˜¯æ–°è€ä¸¤ä¸ª VNode çš„ä¸¤è¾¹çš„ç´¢å¼•ï¼ŒåŒæ—¶ oldStartVnodeã€newStartVnodeã€oldEndVnode ä»¥åŠ newEndVnode åˆ†åˆ«æŒ‡å‘è¿™å‡ ä¸ªç´¢å¼•å¯¹åº”çš„ VNode èŠ‚ç‚¹ã€‚ æŽ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª while å¾ªçŽ¯ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼ŒoldStartIdxã€newStartIdxã€oldEndIdx ä»¥åŠ newEndIdx ä¼šé€æ¸å‘ä¸­é—´é æ‹¢ã€‚ 1while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) é¦–å…ˆå½“ oldStartVnode æˆ–è€… oldEndVnode ä¸å­˜åœ¨çš„æ—¶å€™ï¼ŒoldStartIdx ä¸Ž oldEndIdx ç»§ç»­å‘ä¸­é—´é æ‹¢ï¼Œå¹¶æ›´æ–°å¯¹åº”çš„ oldStartVnode ä¸Ž oldEndVnode çš„æŒ‡å‘ï¼ˆæ³¨ï¼šä¸‹é¢è®²åˆ°çš„ oldStartIdxã€newStartIdxã€oldEndIdx ä»¥åŠ newEndIdx ç§»åŠ¨éƒ½ä¼šä¼´éšç€ oldStartVnodeã€newStartVnodeã€oldEndVnode ä»¥åŠ newEndVnode çš„æŒ‡å‘çš„å˜åŒ–ï¼Œä¹‹åŽçš„éƒ¨åˆ†åªä¼šè®² Idx çš„ç§»åŠ¨ï¼‰ã€‚ 12345if (!oldStartVnode) &#123; oldStartVnode = oldCh[++oldStartIdx];&#125; else if (!oldEndVnode) &#123; oldEndVnode = oldCh[--oldEndIdx];&#125; æŽ¥ä¸‹æ¥è¿™ä¸€å—ï¼Œæ˜¯å°† oldStartIdxã€newStartIdxã€oldEndIdx ä»¥åŠ newEndIdx ä¸¤ä¸¤æ¯”å¯¹çš„è¿‡ç¨‹ï¼Œä¸€å…±ä¼šå‡ºçŽ° 2*2=4 ç§æƒ…å†µã€‚ 12345678910111213141516171819 else if (sameVnode(oldStartVnode, newStartVnode)) &#123; patchVnode(oldStartVnode, newStartVnode); oldStartVnode = oldCh[++oldStartIdx]; newStartVnode = newCh[++newStartIdx];&#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123; patchVnode(oldEndVnode, newEndVnode); oldEndVnode = oldCh[--oldEndIdx]; newEndVnode = newCh[--newEndIdx];&#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; patchVnode(oldStartVnode, newEndVnode); nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm)); oldStartVnode = oldCh[++oldStartIdx]; newEndVnode = newCh[--newEndIdx];&#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; patchVnode(oldEndVnode, newStartVnode); nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm); oldEndVnode = oldCh[--oldEndIdx]; newStartVnode = newCh[++newStartIdx];&#125; é¦–å…ˆæ˜¯ oldStartVnode ä¸Ž newStartVnode ç¬¦åˆ sameVnode æ—¶ï¼Œè¯´æ˜Žè€ VNode èŠ‚ç‚¹çš„å¤´éƒ¨ä¸Žæ–° VNode èŠ‚ç‚¹çš„å¤´éƒ¨æ˜¯ç›¸åŒçš„ VNode èŠ‚ç‚¹ï¼Œç›´æŽ¥è¿›è¡Œ patchVnodeï¼ŒåŒæ—¶ oldStartIdx ä¸Ž newStartIdx å‘åŽç§»åŠ¨ä¸€ä½ã€‚ å…¶æ¬¡æ˜¯ oldEndVnode ä¸Ž newEndVnode ç¬¦åˆ sameVnodeï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª VNode çš„ç»“å°¾æ˜¯ç›¸åŒçš„ VNodeï¼ŒåŒæ ·è¿›è¡Œ patchVnode æ“ä½œå¹¶å°† oldEndVnode ä¸Ž newEndVnode å‘å‰ç§»åŠ¨ä¸€ä½ã€‚ æŽ¥ä¸‹æ¥æ˜¯ä¸¤ç§äº¤å‰çš„æƒ…å†µã€‚ å…ˆæ˜¯ oldStartVnode ä¸Ž newEndVnode ç¬¦åˆ sameVnode çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è€ VNode èŠ‚ç‚¹çš„å¤´éƒ¨ä¸Žæ–° VNode èŠ‚ç‚¹çš„å°¾éƒ¨æ˜¯åŒä¸€èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°† oldStartVnode.elm è¿™ä¸ªèŠ‚ç‚¹ç›´æŽ¥ç§»åŠ¨åˆ° oldEndVnode.elm è¿™ä¸ªèŠ‚ç‚¹çš„åŽé¢å³å¯ã€‚ç„¶åŽ oldStartIdx å‘åŽç§»åŠ¨ä¸€ä½ï¼ŒnewEndIdx å‘å‰ç§»åŠ¨ä¸€ä½ã€‚ åŒç†ï¼ŒoldEndVnode ä¸Ž newStartVnode ç¬¦åˆ sameVnode æ—¶ï¼Œä¹Ÿå°±æ˜¯è€ VNode èŠ‚ç‚¹çš„å°¾éƒ¨ä¸Žæ–° VNode èŠ‚ç‚¹çš„å¤´éƒ¨æ˜¯åŒä¸€èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°† oldEndVnode.elm æ’å…¥åˆ° oldStartVnode.elm å‰é¢ã€‚åŒæ ·çš„ï¼ŒoldEndIdx å‘å‰ç§»åŠ¨ä¸€ä½ï¼ŒnewStartIdx å‘åŽç§»åŠ¨ä¸€ä½ã€‚ æœ€åŽæ˜¯å½“ä»¥ä¸Šæƒ…å†µéƒ½ä¸ç¬¦åˆçš„æ—¶å€™ï¼Œè¿™ç§æƒ…å†µæ€Žä¹ˆå¤„ç†å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930else &#123; let elmToMove = oldCh[idxInOld]; if (!oldKeyToIdx) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx); idxInOld = newStartVnode.key ? oldKeyToIdx[newStartVnode.key] : null; if (!idxInOld) &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx]; &#125; else &#123; elmToMove = oldCh[idxInOld]; if (sameVnode(elmToMove, newStartVnode)) &#123; patchVnode(elmToMove, newStartVnode); oldCh[idxInOld] = undefined; nodeOps.insertBefore(parentElm, newStartVnode.elm, oldStartVnode.elm); newStartVnode = newCh[++newStartIdx]; &#125; else &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx]; &#125; &#125;&#125;function createKeyToOldIdx (children, beginIdx, endIdx) &#123; let i, key const map = &#123;&#125; for (i = beginIdx; i &lt;= endIdx; ++i) &#123; key = children[i].key if (isDef(key)) map[key] = i &#125; return map&#125; createKeyToOldIdx çš„ä½œç”¨æ˜¯äº§ç”Ÿ key ä¸Ž index ç´¢å¼•å¯¹åº”çš„ä¸€ä¸ª map è¡¨ã€‚æ¯”å¦‚è¯´ï¼š 12345[ &#123;xx: xx, key: &apos;key0&apos;&#125;, &#123;xx: xx, key: &apos;key1&apos;&#125;, &#123;xx: xx, key: &apos;key2&apos;&#125;] åœ¨ç»è¿‡ createKeyToOldIdx è½¬åŒ–ä»¥åŽä¼šå˜æˆï¼š 12345&#123; key0: 0, key1: 1, key2: 2&#125; æˆ‘ä»¬å¯ä»¥æ ¹æ®æŸä¸€ä¸ª key çš„å€¼ï¼Œå¿«é€Ÿåœ°ä»Ž oldKeyToIdxï¼ˆcreateKeyToOldIdx çš„è¿”å›žå€¼ï¼‰ä¸­èŽ·å–ç›¸åŒ key çš„èŠ‚ç‚¹çš„ç´¢å¼• idxInOldï¼Œç„¶åŽæ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹ã€‚ å¦‚æžœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡ createElm åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¹¶å°† newStartIdx å‘åŽç§»åŠ¨ä¸€ä½ã€‚ 1234if (!idxInOld) &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx];&#125; å¦åˆ™å¦‚æžœæ‰¾åˆ°äº†èŠ‚ç‚¹ï¼ŒåŒæ—¶å®ƒç¬¦åˆ sameVnodeï¼Œåˆ™å°†è¿™ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œ patchVnodeï¼Œå°†è¯¥ä½ç½®çš„è€èŠ‚ç‚¹èµ‹å€¼ undefinedï¼ˆä¹‹åŽå¦‚æžœè¿˜æœ‰æ–°èŠ‚ç‚¹ä¸Žè¯¥èŠ‚ç‚¹keyç›¸åŒå¯ä»¥æ£€æµ‹å‡ºæ¥æç¤ºå·²æœ‰é‡å¤çš„ key ï¼‰ï¼ŒåŒæ—¶å°† newStartVnode.elm æ’å…¥åˆ° oldStartVnode.elm çš„å‰é¢ã€‚åŒç†ï¼ŒnewStartIdx å¾€åŽç§»åŠ¨ä¸€ä½ã€‚ 123456789else &#123; elmToMove = oldCh[idxInOld]; if (sameVnode(elmToMove, newStartVnode)) &#123; patchVnode(elmToMove, newStartVnode); oldCh[idxInOld] = undefined; nodeOps.insertBefore(parentElm, newStartVnode.elm, oldStartVnode.elm); newStartVnode = newCh[++newStartIdx]; &#125;&#125; å¦‚æžœä¸ç¬¦åˆ sameVnodeï¼Œåªèƒ½åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹æ’å…¥åˆ° parentElm çš„å­èŠ‚ç‚¹ä¸­ï¼ŒnewStartIdx å¾€åŽç§»åŠ¨ä¸€ä½ã€‚ 1234else &#123; createElm(newStartVnode, parentElm); newStartVnode = newCh[++newStartIdx];&#125; æœ€åŽä¸€æ­¥å°±å¾ˆå®¹æ˜“å•¦ï¼Œå½“ while å¾ªçŽ¯ç»“æŸä»¥åŽï¼Œå¦‚æžœ oldStartIdx &gt; oldEndIdxï¼Œè¯´æ˜Žè€èŠ‚ç‚¹æ¯”å¯¹å®Œäº†ï¼Œä½†æ˜¯æ–°èŠ‚ç‚¹è¿˜æœ‰å¤šçš„ï¼Œéœ€è¦å°†æ–°èŠ‚ç‚¹æ’å…¥åˆ°çœŸå®ž DOM ä¸­åŽ»ï¼Œè°ƒç”¨ addVnodes å°†è¿™äº›èŠ‚ç‚¹æ’å…¥å³å¯ã€‚ åŒç†ï¼Œå¦‚æžœæ»¡è¶³ newStartIdx &gt; newEndIdx æ¡ä»¶ï¼Œè¯´æ˜Žæ–°èŠ‚ç‚¹æ¯”å¯¹å®Œäº†ï¼Œè€èŠ‚ç‚¹è¿˜æœ‰å¤šï¼Œå°†è¿™äº›æ— ç”¨çš„è€èŠ‚ç‚¹é€šè¿‡ removeVnodes æ‰¹é‡åˆ é™¤å³å¯ã€‚ 123456if (oldStartIdx &gt; oldEndIdx) &#123; refElm = (newCh[newEndIdx + 1]) ? newCh[newEndIdx + 1].elm : null; addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx);&#125; else if (newStartIdx &gt; newEndIdx) &#123; removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx);&#125; åˆ°è¿™é‡Œï¼Œæ¯”å¯¹çš„æ ¸å¿ƒå®žçŽ°å·²ç»è®²å®Œäº†ï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒå¤æ‚ï¼Œä¸è¿‡ä»”ç»†åœ°æ¢³ç†ä¸€ä¸‹æ¯”å¯¹çš„è¿‡ç¨‹ï¼Œç›¸ä¿¡ä¸€å®šèƒ½å¤Ÿç†è§£å¾—æ›´åŠ é€å½»çš„ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Šæ•°æ®çŠ¶æ€æ›´æ–°æ—¶çš„å·®å¼‚ diff åŠ patch æœºåˆ¶ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®žçŽ° Virtual DOM ä¸‹çš„ä¸€ä¸ª VNode èŠ‚ç‚¹]]></title>
    <url>%2F2018%2F09%2F06%2F%E5%AE%9E%E7%8E%B0%20Virtual%20DOM%20%E4%B8%8B%E7%9A%84%E4%B8%80%E4%B8%AA%20VNode%20%E8%8A%82%E7%82%B9%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯VNodeæˆ‘ä»¬çŸ¥é“ï¼Œrender function ä¼šè¢«è½¬åŒ–æˆ VNode èŠ‚ç‚¹ã€‚Virtual DOM å…¶å®žå°±æ˜¯ä¸€æ£µä»¥ JavaScript å¯¹è±¡ï¼ˆVNode èŠ‚ç‚¹ï¼‰ä½œä¸ºåŸºç¡€çš„æ ‘ï¼Œç”¨å¯¹è±¡å±žæ€§æ¥æè¿°èŠ‚ç‚¹ï¼Œå®žé™…ä¸Šå®ƒåªæ˜¯ä¸€å±‚å¯¹çœŸå®ž DOM çš„æŠ½è±¡ã€‚æœ€ç»ˆå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—æ“ä½œä½¿è¿™æ£µæ ‘æ˜ å°„åˆ°çœŸå®žçŽ¯å¢ƒä¸Šã€‚ç”±äºŽ Virtual DOM æ˜¯ä»¥ JavaScript å¯¹è±¡ä¸ºåŸºç¡€è€Œä¸ä¾èµ–çœŸå®žå¹³å°çŽ¯å¢ƒï¼Œæ‰€ä»¥ä½¿å®ƒå…·æœ‰äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨å¹³å°ã€Weexã€Node ç­‰ã€‚ å®žçŽ°ä¸€ä¸ªVNodeVNode å½’æ ¹ç»“åº•å°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œåªè¦è¿™ä¸ªç±»çš„ä¸€äº›å±žæ€§å¯ä»¥æ­£ç¡®ç›´è§‚åœ°æè¿°æ¸…æ¥šå½“å‰èŠ‚ç‚¹çš„ä¿¡æ¯å³å¯ã€‚æˆ‘ä»¬æ¥å®žçŽ°ä¸€ä¸ªç®€å•çš„ VNode ç±»ï¼ŒåŠ å…¥ä¸€äº›åŸºæœ¬å±žæ€§ï¼Œä¸ºäº†ä¾¿äºŽç†è§£ï¼Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘å¤æ‚çš„æƒ…å†µã€‚ 1234567891011121314class VNode &#123; constructor (tag, data, children, text, elm) &#123; /*å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å*/ this.tag = tag; /*å½“å‰èŠ‚ç‚¹çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚propsã€attrsç­‰æ•°æ®*/ this.data = data; /*å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„*/ this.children = children; /*å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬*/ this.text = text; /*å½“å‰è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå®ždomèŠ‚ç‚¹*/ this.elm = elm; &#125;&#125; æ¯”å¦‚æˆ‘ç›®å‰æœ‰è¿™ä¹ˆä¸€ä¸ª Vue ç»„ä»¶ã€‚ 12345&lt;template&gt; &lt;span class=&quot;demo&quot; v-show=&quot;isShow&quot;&gt; This is a span. &lt;/span&gt;&lt;/template&gt; ç”¨ JavaScript ä»£ç å½¢å¼å°±æ˜¯è¿™æ ·çš„ã€‚ 1234567891011121314151617181920function render () &#123; return new VNode( &apos;span&apos;, &#123; /* æŒ‡ä»¤é›†åˆæ•°ç»„ */ directives: [ &#123; /* v-showæŒ‡ä»¤ */ rawName: &apos;v-show&apos;, expression: &apos;isShow&apos;, name: &apos;show&apos;, value: true &#125; ], /* é™æ€class */ staticClass: &apos;demo&apos; &#125;, [ new VNode(undefined, undefined, undefined, &apos;This is a span.&apos;) ] );&#125; çœ‹çœ‹è½¬æ¢æˆ VNode ä»¥åŽçš„æƒ…å†µã€‚ 123456789101112131415161718192021222324252627&#123; tag: &apos;span&apos;, data: &#123; /* æŒ‡ä»¤é›†åˆæ•°ç»„ */ directives: [ &#123; /* v-showæŒ‡ä»¤ */ rawName: &apos;v-show&apos;, expression: &apos;isShow&apos;, name: &apos;show&apos;, value: true &#125; ], /* é™æ€class */ staticClass: &apos;demo&apos; &#125;, text: undefined, children: [ /* å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–‡æœ¬VNodeèŠ‚ç‚¹ */ &#123; tag: undefined, data: undefined, text: &apos;This is a span.&apos;, children: undefined &#125; ]&#125; ç„¶åŽæˆ‘ä»¬å¯ä»¥å°† VNode è¿›ä¸€æ­¥å°è£…ä¸€ä¸‹ï¼Œå¯ä»¥å®žçŽ°ä¸€äº›äº§ç”Ÿå¸¸ç”¨ VNode çš„æ–¹æ³•ã€‚ åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ 12345function createEmptyVNode () &#123; const node = new VNode(); node.text = &apos;&apos;; return node;&#125; åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ 123function createTextVNode (val) &#123; return new VNode(undefined, undefined, undefined, String(val));&#125; å…‹éš†ä¸€ä¸ª VNode èŠ‚ç‚¹ 12345678910function cloneVNode (node) &#123; const cloneVnode = new VNode( node.tag, node.data, node.children, node.text, node.elm ); return cloneVnode;&#125; æ€»çš„æ¥è¯´ï¼ŒVNode å°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œç”¨ JavaScript å¯¹è±¡çš„å±žæ€§æ¥æè¿°å½“å‰èŠ‚ç‚¹çš„ä¸€äº›çŠ¶æ€ï¼Œç”¨ VNode èŠ‚ç‚¹çš„å½¢å¼æ¥æ¨¡æ‹Ÿä¸€æ£µ Virtual DOM æ ‘ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Šå®žçŽ° Virtual DOM ä¸‹çš„ä¸€ä¸ª VNode èŠ‚ç‚¹ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥åŠ nextTick åŽŸç†]]></title>
    <url>%2F2018%2F09%2F03%2F%E6%89%B9%E9%87%8F%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5%E5%8F%8A%20nextTick%20%E5%8E%9F%E7%90%86%2F</url>
    <content type="text"><![CDATA[ä¸ºä»€ä¹ˆè¦å¼‚æ­¥æ›´æ–°é€šè¿‡å‰é¢å‡ ä¸ªç« èŠ‚æˆ‘ä»¬ä»‹ç»ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æ˜Žç™½äº† Vue.js æ˜¯å¦‚ä½•åœ¨æˆ‘ä»¬ä¿®æ”¹ data ä¸­çš„æ•°æ®åŽä¿®æ”¹è§†å›¾äº†ã€‚ç®€å•å›žé¡¾ä¸€ä¸‹ï¼Œè¿™é‡Œé¢å…¶å®žå°±æ˜¯ä¸€ä¸ªâ€œsetter -&gt; Dep -&gt; Watcher -&gt; patch -&gt; è§†å›¾â€çš„è¿‡ç¨‹ã€‚ å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹è¿™ä¹ˆä¸€ç§æƒ…å†µã€‚ 123456&lt;template&gt; &lt;div&gt; &lt;div&gt;&#123;&#123;number&#125;&#125;&lt;/div&gt; &lt;div @click=&quot;handleClick&quot;&gt;click&lt;/div&gt; &lt;/div&gt;&lt;/template&gt; 1234567891011121314export default &#123; data () &#123; return &#123; number: 0 &#125;; &#125;, methods: &#123; handleClick () &#123; for(let i = 0; i &lt; 1000; i++) &#123; this.number++; &#125; &#125; &#125;&#125; å½“æˆ‘ä»¬æŒ‰ä¸‹ click æŒ‰é’®çš„æ—¶å€™ï¼Œnumber ä¼šè¢«å¾ªçŽ¯å¢žåŠ 1000æ¬¡ã€‚ é‚£ä¹ˆæŒ‰ç…§ä¹‹å‰çš„ç†è§£ï¼Œæ¯æ¬¡ number è¢« +1 çš„æ—¶å€™ï¼Œéƒ½ä¼šè§¦å‘ number çš„ setter æ–¹æ³•ï¼Œä»Žè€Œæ ¹æ®ä¸Šé¢çš„æµç¨‹ä¸€ç›´è·‘ä¸‹æ¥æœ€åŽä¿®æ”¹çœŸå®ž DOMã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDOM ä¼šè¢«æ›´æ–° 1000 æ¬¡ï¼å¤ªå¯æ€•äº†ã€‚ Vue.js è‚¯å®šä¸ä¼šä»¥å¦‚æ­¤ä½Žæ•ˆçš„æ–¹æ³•æ¥å¤„ç†ã€‚Vue.jsåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡è§¦å‘æŸä¸ªæ•°æ®çš„ setter æ–¹æ³•åŽï¼Œå¯¹åº”çš„ Watcher å¯¹è±¡å…¶å®žä¼šè¢« push è¿›ä¸€ä¸ªé˜Ÿåˆ— queue ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™å°†è¿™ä¸ªé˜Ÿåˆ— queue å…¨éƒ¨æ‹¿å‡ºæ¥ runï¼ˆ Watcher å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è§¦å‘ patch æ“ä½œï¼‰ ä¸€éã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸‹ä¸€ä¸ª tick å‘¢ï¼Ÿ nextTickVue.js å®žçŽ°äº†ä¸€ä¸ª nextTick å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª cb ï¼Œè¿™ä¸ª cb ä¼šè¢«å­˜å‚¨åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick æ—¶è§¦å‘é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ cb äº‹ä»¶ã€‚ å› ä¸ºç›®å‰æµè§ˆå™¨å¹³å°å¹¶æ²¡æœ‰å®žçŽ° nextTick æ–¹æ³•ï¼Œæ‰€ä»¥ Vue.js æºç ä¸­åˆ†åˆ«ç”¨ Promiseã€setTimeoutã€setImmediate ç­‰æ–¹å¼åœ¨ microtaskï¼ˆæˆ–æ˜¯taskï¼‰ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œç›®çš„æ˜¯åœ¨å½“å‰è°ƒç”¨æ ˆæ‰§è¡Œå®Œæ¯•ä»¥åŽï¼ˆä¸ä¸€å®šç«‹å³ï¼‰æ‰ä¼šåŽ»æ‰§è¡Œè¿™ä¸ªäº‹ä»¶ã€‚ ç¬”è€…ç”¨ setTimeout æ¥æ¨¡æ‹Ÿè¿™ä¸ªæ–¹æ³•ï¼Œå½“ç„¶ï¼ŒçœŸå®žçš„æºç ä¸­ä¼šæ›´åŠ å¤æ‚ï¼Œç¬”è€…åœ¨å°å†Œä¸­åªè®²åŽŸç†ï¼Œæœ‰å…´è¶£äº†è§£æºç ä¸­ nextTick çš„å…·ä½“å®žçŽ°çš„åŒå­¦å¯ä»¥å‚è€ƒnext-tickã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ª callbacks æ•°ç»„ç”¨æ¥å­˜å‚¨ nextTickï¼Œåœ¨ä¸‹ä¸€ä¸ª tick å¤„ç†è¿™äº›å›žè°ƒå‡½æ•°ä¹‹å‰ï¼Œæ‰€æœ‰çš„ cb éƒ½ä¼šè¢«å­˜åœ¨è¿™ä¸ª callbacks æ•°ç»„ä¸­ã€‚pending æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œä»£è¡¨ä¸€ä¸ªç­‰å¾…çš„çŠ¶æ€ã€‚ setTimeout ä¼šåœ¨ task ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ flushCallbacks ï¼ŒflushCallbacks åˆ™ä¼šåœ¨æ‰§è¡Œæ—¶å°† callbacks ä¸­çš„æ‰€æœ‰ cb ä¾æ¬¡æ‰§è¡Œã€‚ 1234567891011121314151617181920let callbacks = [];let pending = false;function nextTick (cb) &#123; callbacks.push(cb); if (!pending) &#123; pending = true; setTimeout(flushCallbacks, 0); &#125;&#125;function flushCallbacks () &#123; pending = false; const copies = callbacks.slice(0); callbacks.length = 0; for (let i = 0; i &lt; copies.length; i++) &#123; copies[i](); &#125;&#125; å†å†™ Watcherç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬å°† number å¢žåŠ  1000 æ¬¡æ—¶ï¼Œå…ˆå°†å¯¹åº”çš„ Watcher å¯¹è±¡ç»™ push è¿›ä¸€ä¸ªé˜Ÿåˆ— queue ä¸­åŽ»ï¼Œç­‰ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™å†åŽ»æ‰§è¡Œï¼Œè¿™æ ·åšæ˜¯å¯¹çš„ã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å‘çŽ°ï¼Œå¦ä¸€ä¸ªé—®é¢˜å‡ºçŽ°äº†ï¼Ÿ å› ä¸º number æ‰§è¡Œ ++ æ“ä½œä»¥åŽå¯¹åº”çš„ Watcher å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™æ‰§è¡Œ 1000 ä¸ªåŒæ ·çš„ Watcher å¯¹è±¡åŽ»ä¿®æ”¹ç•Œé¢ï¼Œè€Œæ˜¯åªéœ€è¦æ‰§è¡Œä¸€ä¸ª Watcher å¯¹è±¡ï¼Œä½¿å…¶å°†ç•Œé¢ä¸Šçš„ 0 å˜æˆ 1000 å³å¯ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰§è¡Œä¸€ä¸ªè¿‡æ»¤çš„æ“ä½œï¼ŒåŒä¸€ä¸ªçš„ Watcher åœ¨åŒä¸€ä¸ª tick çš„æ—¶å€™åº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´é˜Ÿåˆ— queue ä¸­ä¸åº”è¯¥å‡ºçŽ°é‡å¤çš„ Watcher å¯¹è±¡ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç»™ Watcher å¯¹è±¡èµ·ä¸ªåå­—å§ï½žç”¨ id æ¥æ ‡è®°æ¯ä¸€ä¸ª Watcher å¯¹è±¡ï¼Œè®©ä»–ä»¬çœ‹èµ·æ¥â€œä¸å¤ªä¸€æ ·â€ã€‚ å®žçŽ° update æ–¹æ³•ï¼Œåœ¨ä¿®æ”¹æ•°æ®åŽç”± Dep æ¥è°ƒç”¨ï¼Œ è€Œ run æ–¹æ³•æ‰æ˜¯çœŸæ­£çš„è§¦å‘ patch æ›´æ–°è§†å›¾çš„æ–¹æ³•ã€‚ 12345678910111213141516let uid = 0;class Watcher &#123; constructor () &#123; this.id = ++uid; &#125; update () &#123; console.log(&apos;watch&apos; + this.id + &apos; update&apos;); queueWatcher(this); &#125; run () &#123; console.log(&apos;watch&apos; + this.id + &apos;è§†å›¾æ›´æ–°å•¦ï½ž&apos;); &#125;&#125; queueWatcherä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°äº†æ²¡æœ‰ï¼Ÿç¬”è€…å·²ç»å°† Watcher çš„ update ä¸­çš„å®žçŽ°æ”¹æˆäº† 1queueWatcher(this); å°† Watcher å¯¹è±¡è‡ªèº«ä¼ é€’ç»™ queueWatcher æ–¹æ³•ã€‚ æˆ‘ä»¬æ¥å®žçŽ°ä¸€ä¸‹ queueWatcher æ–¹æ³•ã€‚ 12345678910111213141516let has = &#123;&#125;;let queue = [];let waiting = false;function queueWatcher(watcher) &#123; const id = watcher.id; if (has[id] == null) &#123; has[id] = true; queue.push(watcher); if (!waiting) &#123; waiting = true; nextTick(flushSchedulerQueue); &#125; &#125;&#125; æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå«åš has çš„ mapï¼Œé‡Œé¢å­˜æ”¾ id -&gt; true ( false ) çš„å½¢å¼ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„ Watcher å¯¹è±¡ ï¼ˆè¿™æ ·æ¯”æ¯æ¬¡éƒ½åŽ»éåŽ† queue æ•ˆçŽ‡ä¸Šä¼šé«˜å¾ˆå¤šï¼‰ã€‚ å¦‚æžœç›®å‰é˜Ÿåˆ— queue ä¸­è¿˜æ²¡æœ‰è¿™ä¸ª Watcher å¯¹è±¡ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢« push è¿›é˜Ÿåˆ— queue ä¸­åŽ»ã€‚ waiting æ˜¯ä¸€ä¸ªæ ‡è®°ä½ï¼Œæ ‡è®°æ˜¯å¦å·²ç»å‘ nextTick ä¼ é€’äº† flushSchedulerQueue æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™æ‰§è¡Œ flushSchedulerQueue æ–¹æ³•æ¥ flush é˜Ÿåˆ— queueï¼Œæ‰§è¡Œå®ƒé‡Œé¢çš„æ‰€æœ‰ Watcher å¯¹è±¡çš„ run æ–¹æ³•ã€‚ flushSchedulerQueue123456789101112function flushSchedulerQueue () &#123; let watcher, id; for (index = 0; index &lt; queue.length; index++) &#123; watcher = queue[index]; id = watcher.id; has[id] = null; watcher.run(); &#125; waiting = false;&#125; ä¸¾ä¸ªä¾‹å­123456let watch1 = new Watcher();let watch2 = new Watcher();watch1.update();watch1.update();watch2.update(); æˆ‘ä»¬çŽ°åœ¨ new äº†ä¸¤ä¸ª Watcher å¯¹è±¡ï¼Œå› ä¸ºä¿®æ”¹äº† data çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿè§¦å‘äº†ä¸¤æ¬¡ watch1 çš„ update ä»¥åŠ ä¸€æ¬¡ watch2 çš„ updateã€‚ å‡è®¾æ²¡æœ‰æ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥çš„è¯ï¼Œç†è®ºä¸Šåº”è¯¥æ‰§è¡Œ Watcher å¯¹è±¡çš„ runï¼Œé‚£ä¹ˆä¼šæ‰“å°ã€‚ 123456watch1 updatewatch1è§†å›¾æ›´æ–°å•¦ï½žwatch1 updatewatch1è§†å›¾æ›´æ–°å•¦ï½žwatch2 updatewatch2è§†å›¾æ›´æ–°å•¦ï½ž å®žé™…ä¸Šåˆ™æ‰§è¡Œ 12345watch1 updatewatch1 updatewatch2 updatewatch1è§†å›¾æ›´æ–°å•¦ï½žwatch2è§†å›¾æ›´æ–°å•¦ï½ž è¿™å°±æ˜¯å¼‚æ­¥æ›´æ–°ç­–ç•¥çš„æ•ˆæžœï¼Œç›¸åŒçš„ Watcher å¯¹è±¡ä¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¢«å‰”é™¤ï¼Œåœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™åŽ»æ›´æ–°è§†å›¾ï¼Œä»Žè€Œè¾¾åˆ°å¯¹æˆ‘ä»¬ç¬¬ä¸€ä¸ªä¾‹å­çš„ä¼˜åŒ–ã€‚ æˆ‘ä»¬å†å›žè¿‡å¤´èŠä¸€ä¸‹ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œ number ä¼šè¢«ä¸åœåœ°è¿›è¡Œ ++ æ“ä½œï¼Œä¸æ–­åœ°è§¦å‘å®ƒå¯¹åº”çš„ Dep ä¸­çš„ Watcher å¯¹è±¡çš„ update æ–¹æ³•ã€‚ç„¶åŽæœ€ç»ˆ queue ä¸­å› ä¸ºå¯¹ç›¸åŒ id çš„ Watcher å¯¹è±¡è¿›è¡Œäº†ç­›é€‰ï¼Œä»Žè€Œ queue ä¸­å®žé™…ä¸Šåªä¼šå­˜åœ¨ä¸€ä¸ª number å¯¹åº”çš„ Watcher å¯¹è±¡ã€‚åœ¨ä¸‹ä¸€ä¸ª tick çš„æ—¶å€™ï¼ˆæ­¤æ—¶ number å·²ç»å˜æˆäº† 1000ï¼‰ï¼Œè§¦å‘ Watcher å¯¹è±¡çš„ run æ–¹æ³•æ¥æ›´æ–°è§†å›¾ï¼Œå°†è§†å›¾ä¸Šçš„ number ä»Ž 0 ç›´æŽ¥å˜æˆ 1000ã€‚ åˆ°è¿™é‡Œï¼Œæ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥åŠ nextTick åŽŸç†å·²ç»è®²å®Œäº†ï¼ŒæŽ¥ä¸‹æ¥è®©æˆ‘ä»¬å­¦ä¹ ä¸€ä¸‹ Vuex çŠ¶æ€ç®¡ç†çš„å·¥ä½œåŽŸç†ã€‚ æ³¨ï¼šæœ¬èŠ‚ä»£ç å‚è€ƒã€Šæ‰¹é‡å¼‚æ­¥æ›´æ–°ç­–ç•¥åŠ nextTick åŽŸç†ã€‹ã€‚]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŽŸåž‹æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F04%2F%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å…‹éš†è‡ªå·±ç”Ÿæˆæ–°å¯¹è±¡ ç›¸å…³ä»£ç å®žçŽ°123456789101112131415161718192021// ä¸€ä¸ªåŽŸåž‹å¯¹è±¡let prototype = &#123; getName:function () &#123; return this.first + ' ' + this.last &#125;, say: function () &#123; alert('hello') &#125;&#125;//åŸºäºŽåŽŸåž‹åˆ›å»ºxlet x = Object.create(prototype)x.first = 'A'x.last = 'B'alert(x.getName())x.say()//åŸºäºŽåŽŸåž‹åˆ›å»ºylet y = Object.create(prototype)y.first = 'C'y.last = 'D'alert(y.getName())y.say()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼å’ŒèŒè´£é“¾æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F04%2F%E6%A8%A1%E7%89%88%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E5%92%8C%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼12345678910111213141516class Action &#123; handle() &#123; this.handle1() this.handle2() this.handle3() &#125; handle1() &#123; console.log('1') &#125; handle2() &#123; console.log('2') &#125; handle3() &#123; console.log('3') &#125;&#125; èŒè´£é“¾æ¨¡å¼ä¸€ä¸ªæ“ä½œå¯èƒ½åˆ†ä¸ºå¤šä¸ªèŒè´£è§’è‰²æ¥å®Œæˆï¼ŒæŠŠè¿™äº›è§’è‰²éƒ½åˆ†å¼€ï¼Œç„¶åŽç”¨ä¸€ä¸ªé“¾ä¸²èµ·æ¥ï¼Œå°†å‘èµ·è€…å’Œå„ä¸ªå¤„ç†è€…è¿›è¡Œéš”ç¦» 123456789101112131415161718192021class Action &#123; constructor(name) &#123; this.name = name this.nextAction = null &#125; setNextAction(action) &#123; this.nextAction = action &#125; handle() &#123; console.log(`$&#123;this.name&#125;å®¡æ‰¹`) if (this.nextAction!=null)&#123; this.nextAction.handle() &#125; &#125;&#125;let a1 = new Action('ç»„é•¿')let a2 = new Action('ç»ç†')let a3 = new Action('æ€»ç›‘')a1.setNextAction(a2)a2.setNextAction(a3)a1.handle()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nginx locationè¯¦è§£]]></title>
    <url>%2F2018%2F07%2F04%2Fnginx%20location%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[è¯­æ³•è§„åˆ™location [=|~|~*|^~] /uri/ {â€¦.} 123456789101112131415161718192021222324252627282930313233class Receiver &#123; exec() &#123; console.log('æ‰§è¡Œ') &#125;&#125;class Command &#123; constructor(receiver) &#123; this.receiver = receiver &#125; cmd() &#123; console.log('æ‰§è¡Œå‘½ä»¤') this.receiver.exec() &#125;&#125;class Invoker &#123; constructor(command) &#123; this.command = command &#125; invoke() &#123; console.log('å¼€å§‹') this.command.cmd() &#125;&#125;//å£«å…µlet soldier = new Receiver()//å°å·æ‰‹let trumpeter = new Command(soldier)//å°†å†›let general = new Invoker(trumpeter)general.invoke()]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‘½ä»¤æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F04%2F%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å…‹éš†è‡ªå·±ç”Ÿæˆæ–°å¯¹è±¡ ç›¸å…³ä»£ç å®žçŽ°123456789101112131415161718192021222324252627282930313233class Receiver &#123; exec() &#123; console.log('æ‰§è¡Œ') &#125;&#125;class Command &#123; constructor(receiver) &#123; this.receiver = receiver &#125; cmd() &#123; console.log('æ‰§è¡Œå‘½ä»¤') this.receiver.exec() &#125;&#125;class Invoker &#123; constructor(command) &#123; this.command = command &#125; invoke() &#123; console.log('å¼€å§‹') this.command.cmd() &#125;&#125;//å£«å…µlet soldier = new Receiver()//å°å·æ‰‹let trumpeter = new Command(soldier)//å°†å†›let general = new Invoker(trumpeter)general.invoke()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vueé¡¹ç›®çš„nginxé…ç½®]]></title>
    <url>%2F2018%2F07%2F03%2Fvue%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9A%84nginx%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[vueé¡¹ç›®çš„config/index.jsæ–‡ä»¶ç›¸å…³é…ç½® 1234567891011build: &#123; env: require('./prod.env'), index: path.resolve(__dirname, '../dist/index.html'), assetsRoot: path.resolve(__dirname, '../dist'), assetsSubDirectory: 'static', assetsPublicPath: '/weixin/', //é¡¹ç›®åç§° productionSourceMap: false, productionGzip: true, productionGzipExtensions: ['js', 'css'], bundleAnalyzerReport: process.env.npm_config_report &#125;, å¯¹åº”çš„nginxé…ç½® 123456789101112131415161718192021222324252627282930313233343536server&#123; listen 80; server_name www.xxxxx.com; //è®¿é—®webçš„åŸŸå location ~ .*\.(html|htm|ico|txt|js|css|woff2?|eot|ttf|otf|png|jpe?g|gif|svg|exe)$ &#123; root html/xxxx/dist; index index.html index.htm index.jsp; &#125; // å½“ä»¥html|htm|ico|txt|js|css|woff2?|eot|ttf|otf|png|jpe?g|gif|svg|exeè¿™äº›æ–‡ä»¶ç»“å°¾çš„æ–‡ä»¶æ‰¾ä¸åˆ°æ—¶å°±åŽ»html/xxxx/dist;å°±åŽ»è¿™ä¸ªç›®å½•åŽ»æ‰¾ location /api &#123; index index.html index.htm index.jsp; rewrite $1 /; proxy_pass http://172.168.8.196:32/weixin; //webé¡¹ç›®è®¿é—®çš„æœåŠ¡å™¨çš„åŸŸå proxy_cookie_path /PKECUser /; proxy_set_header Host $host; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125; location /websocket &#123; rewrite $1 /; proxy_pass http://localhost:8082/; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection "upgrade"; proxy_read_timeout 86400; &#125; location ^~ /image&#123; root /usr/local/image; &#125; location ^~ /weixin &#123; alias html/xxxx/dist; &#125; // è®¿é—®é“¾æŽ¥åŒ¹é…åˆ°weixinå°±ä¼šåŽ»è®¿é—®webåœ¨æœåŠ¡å™¨ä¸Šçš„ç›®å½• location / &#123; try_files $uri $uri/ /index.html; &#125; //å¯ä»¥è®©vueé¡¹ç›®çš„vuerouterçš„å„ä¸ªè·¯ç”±å¯ä»¥å•ç‹¬è®¿é—®&#125; æç¤º è¯¥webé¡¹ç›®çš„è®¿é—®çš„é“¾æŽ¥http://www.xxxxx.com/weixin]]></content>
      <categories>
        <category>nginx</category>
        <category>vue</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çŠ¶æ€æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F03%2F%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç›¸å…³ä»£ç å®žçŽ°12345678910111213141516171819202122232425262728293031323334353637class State &#123; constructor(color) &#123; this.color = color &#125; handle(context) &#123; console.log(`turn to $&#123;this.color&#125; light`) context.setState(this) &#125;&#125;class Context &#123; constructor() &#123; this.state = null &#125; getState() &#123; return this.state &#125; setState(state)&#123; this.state = state &#125;&#125;let context = new Context()let green = new State('green')let yellow = new State('yellow')let red = new State('red')green.handle(context)console.log(context.getState())yellow.handle(context)console.log(context.getState())red.handle(context)console.log(context.getState())green.handle(context) åœºæ™¯1 æ”¶è— å–æ¶ˆæ”¶è— 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import StateMachine from 'javascript-state-machine'import $ from 'jquery'//åˆå§‹åŒ–çŠ¶æ€æœºæ¨¡åž‹let fm = new StateMachine(&#123; init: 'æ”¶è—', transitions: [ &#123; name: 'doStore', from: 'æ”¶è—', to:'å–æ¶ˆæ”¶è—' &#125;, &#123; name: 'deleteStore', from: 'å–æ¶ˆæ”¶è—', to: 'æ”¶è—' &#125; ], methods: &#123; //ç›‘å¬æ‰§è¡Œæ”¶è— onDoStore: function () &#123; alert('æ”¶è—æˆåŠŸ') updateText() &#125;, // ç›‘å¬å–æ¶ˆæ”¶è— onDeleteStore: function () &#123; alert('å·²ç»å–æ¶ˆæ”¶è—') updateText() &#125; &#125;&#125;)let $btn = $('#btn1')// æŒ‰é’®ç‚¹å‡»äº‹ä»¶$btn.click(function () &#123; if (fm.is('æ”¶è—'))&#123; fm.doStore() &#125;else &#123; fm.deleteStore() &#125;&#125;)//æ›´æ–°æŒ‰é’®çš„æ–‡æ¡ˆfunction updateText () &#123; $btn.text(fm.state)&#125;updateText() åœºæ™¯2 Promiseç®€å•å®žçŽ° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import StateMachine from 'javascript-state-machine'//çŠ¶æ€æœºæ¨¡åž‹let fsm = new StateMachine(&#123; init: 'pending', transitions: [ &#123; name: 'resolve', //äº‹ä»¶åç§° from: 'pending', to: 'fullfilled' &#125;, &#123; name: 'reject', //äº‹ä»¶åç§° from: 'pending', to: 'rejected' &#125; ], methods: &#123; // ç›‘å¬ resolve onResolve: function (state,data) &#123; // state if (data) &#123; data.successList.forEach(fn =&gt; fn()) &#125; &#125;, // ç›‘å¬ reject onReject: function (state,data) &#123; if (data) &#123; data.failList.forEach(fn =&gt; fn()) &#125; &#125; &#125;&#125;)//å®šä¹‰Promiseclass MyPromise &#123; constructor(fn) &#123; this.successList = [] this.failList = [] let _this = this fn(function () &#123; fsm.resolve(_this) &#125;,function () &#123; fsm.reject(_this) &#125;) &#125; then(successFn, failedFn)&#123; this.successList.push(successFn) this.failList.push(failedFn) &#125;&#125;function loadImg (src) &#123; const promise = new MyPromise(function (resolve,reject) &#123; let img = document.createElement('img') img.onload = function () &#123; resolve() &#125; img.onerror = function () &#123; reject() &#125; img.src = src &#125;) return promise&#125;let src = 'https://github.com/youguodong/blogImages/blob/master/è®¾è®¡æ¨¡å¼/8.png?raw=true'let result = loadImg(src)result.then(function () &#123; console.log('ok1')&#125;,function () &#123; console.log('fail1')&#125;)result.then(function () &#123; console.log('ok2')&#125;,function () &#123; console.log('fail2')&#125;)]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F02%2F%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å‘å¸ƒï¼Œè®¢é˜…ï¼Œä¸€å¯¹å¤š ç›¸å…³ä»£ç å®žçŽ°1234567891011121314151617181920212223242526272829303132333435363738394041424344// ä¸»é¢˜ï¼Œä¿å­˜çŠ¶æ€ï¼ŒçŠ¶æ€å˜åŒ–ä¹‹åŽè§¦å‘æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡class Subject &#123; constructor() &#123; this.state = 0 this.observers = [] &#125; getState() &#123; return this.state &#125; setState(state)&#123; this.state = state this.notifyAllObservers() &#125; notifyAllObservers() &#123; this.observers.forEach(observer =&gt; &#123; observer.update() &#125;) &#125; attach(observer) &#123; this.observers.push(observer) &#125;&#125;// è§‚å¯Ÿè€…class Observer &#123; constructor(name, subject) &#123; this.name = name this.subject = subject this.subject.attach(this) &#125; update() &#123; console.log(`$&#123;this.name&#125; update, state: $&#123;this.subject.getState()&#125;`) &#125;&#125;// æµ‹è¯•let s = new Subject()let o1 = new Observer('o1',s)let o2 = new Observer('o2',s)let o3 = new Observer('O3',s)s.setState(1)s.setState(2)s.setState(3) åœºæ™¯1 ç½‘é¡µæ—¶é—´ç»‘å®š 12345678910111213141516&lt;body&gt; &lt;button id="btn1"&gt;btn&lt;/button&gt;&lt;/body&gt;&lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"&gt;&lt;/script&gt;&lt;script&gt; $('#btn1').click(function () &#123; console.log(1) &#125;) $('#btn2').click(function () &#123; console.log(2) &#125;) $('#btn3').click(function () &#123; console.log(3) &#125;)&lt;/script&gt; åœºæ™¯2 Promise 123456789101112131415161718192021function loadImg () &#123; let promise = new Promise(function (resolve, reject) &#123; let img = document.createElement('img') img.onload = function () &#123; resolve(img) &#125; img.onerror = function () &#123; reject('å›¾ç‰‡åŠ è½½å¤±è´¥') &#125; img.src = src &#125;) return promise&#125;let src = 'https://github.com/youguodong/blogImages/blob/master/è®¾è®¡æ¨¡å¼/6.png?raw=true'let result = loadImg(src)result.then(function (img) &#123; console.log('width',img.width)&#125;).then(function (img) &#123; console.log('height',img.height)&#125;) åœºæ™¯3 jQuery callbacks 12345678910111213141516&lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"&gt;&lt;/script&gt;&lt;script&gt;//è‡ªå®šä¹‰äº‹ä»¶let callbacks = $.Callbacks()callbacks.add(function (info) &#123; console.log('fn1',info)&#125;)callbacks.add(function (info) &#123; console.log('fn2',info)&#125;)callbacks.add(function (info) &#123; console.log('fn3',info)&#125;)callbacks.fire('gogogo')callbacks.fire('hello world')&lt;/script&gt;]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è¿­ä»£å™¨æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F01%2F%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç›¸å…³ä»£ç å®žçŽ°12345678910111213141516171819202122232425262728293031323334class Iterator &#123; constructor(container) &#123; this.list = container.list this.index = 0 &#125; next() &#123; if (this.hasNext()) &#123; return this.list[this.index++] &#125; return null &#125; hasNext() &#123; if (this.index &gt;= this.list.length)&#123; return false &#125; return true &#125;&#125;class Container &#123; constructor(list) &#123; this.list = list &#125; getIterator() &#123; return new Iterator(this) &#125;&#125;let arr = [1,2,3,4,5,6]let container = new Container(arr)let iterator = container.getIterator()while (iterator.hasNext())&#123; console.log(iterator.next())&#125; åœºæ™¯1 jQuery each 123456789101112131415161718192021222324252627&lt;body&gt; &lt;div id="div1"&gt; &lt;a href="#"&gt;a1&lt;/a&gt; &lt;a href="#"&gt;a2&lt;/a&gt; &lt;a href="#"&gt;a3&lt;/a&gt; &lt;a href="#"&gt;a4&lt;/a&gt; &lt;a href="#"&gt;a5&lt;/a&gt; &lt;a href="#"&gt;a6&lt;/a&gt; &lt;/div&gt; &lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"&gt; &lt;/script&gt; &lt;script&gt; let arr = [1,2,3] let nodeList = document.getElementsByTagName('a') let $a = $('a') function each (data) &#123; let $data = $(data) $data.each(function (key, val) &#123; console.log(key,val) &#125;) &#125; each(arr) each(nodeList) each($a) &lt;/script&gt;&lt;/body&gt; åœºæ™¯2 es6 Iterator 123456789101112131415161718192021222324252627282930313233function each (data) &#123; let iterator = data[Symbol.iterator]() let item = &#123;done: false&#125; while (!item.done)&#123; item = iterator.next() if (!item.done)&#123; console.log(item.value) &#125; &#125;&#125;let arr = [1,2,3,4]let nodeList = document.getElementsByTagName('p')let m = new Map()m.set('a',100)m.set('b',100)each(arr)each(nodeList)each(m)//ç®€åŒ–åŽfunction each (data) &#123; for (let item of data)&#123; console.log(item) &#125;&#125;let arr = [1,2,3,4]let nodeList = document.getElementsByTagName('p')let m = new Map()m.set('a',100)m.set('b',100)each(arr)each(nodeList)each(m)]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ¡¥æŽ¥æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F01%2F%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç”¨äºŽæŠŠæŠ½è±¡åŒ–å’Œå®žçŽ°åŒ–è§£è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ– #####ä½¿ç”¨æ¡¥æŽ¥æ¨¡å¼ä¹‹å‰ ç›¸å…³ä»£ç å®žçŽ° 1234567891011121314151617181920class ColorShape &#123; yellowCircle() &#123; console.log('yellow circle') &#125; redCircle() &#123; console.log('red circle') &#125; yellowTriangle() &#123; console.log('yellow triangle') &#125; redTriangle() &#123; console.log('red triangle') &#125;&#125;let cs = new ColorShape()cs.yellowCircle()cs.redCircle()cs.yellowTriangle()cs.redTriangle() ä½¿ç”¨æ¡¥æŽ¥æ¨¡å¼ä¹‹åŽ ç›¸å…³ä»£ç å®žçŽ° 1234567891011121314151617181920212223class Color &#123; constructor(name) &#123; this.name = name &#125;&#125;class Shape &#123; constructor(name, color) &#123; this.name = name this.color = color &#125; draw() &#123; console.log(`$&#123;this.color.name&#125; $&#123;this.name&#125;`) &#125;&#125;let red = new Color('red')let yellow = new Color('yellow')let cicle = new Shape('cicle',red)cicle.draw()let triangle = new Shape('triangle',yellow)triangle.draw()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤–è§‚æ¨¡å¼]]></title>
    <url>%2F2018%2F07%2F01%2F%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç›¸å…³ä»£ç å®žçŽ°1234567891011function bindEvent (elem, type, selector, fn) &#123; if (fn == null)&#123; fn = selector selector = null &#125; // ****&#125;//è°ƒç”¨bindEvent(elem,'click','#div1',fn)bindEvent(elem,'click',fn)]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»£ç†æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F28%2F%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨è€…æ— æƒè®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œä¸­é—´åŠ ä»£ç†ï¼Œé€šè¿‡ä»£ç†åšæŽˆæƒå’ŒæŽ§åˆ¶ ç›¸å…³ä»£ç å®žçŽ°1234567891011121314151617181920212223class ReadImg &#123; constructor(fileName) &#123; this.fileName = fileName this.loadFromDisk() &#125; display() &#123; console.log('display...' + this.fileName) &#125; loadFromDisk() &#123; console.log('loading...' + this.fileName) &#125;&#125;class ProxyImg &#123; constructor(fileName) &#123; this.realImg = new ReadImg(fileName) &#125; display() &#123; this.realImg.display() &#125;&#125;let proxyImg = new ProxyImg('1.png')proxyImg.display() ä½¿ç”¨åœºæ™¯åœºæ™¯1 ç½‘é¡µäº‹ä»¶ä»£ç† 1234567891011121314151617181920212223&lt;body&gt; &lt;div id="div1"&gt; &lt;a href="#"&gt;a1&lt;/a&gt; &lt;a href="#"&gt;a2&lt;/a&gt; &lt;a href="#"&gt;a3&lt;/a&gt; &lt;a href="#"&gt;a4&lt;/a&gt; &lt;a href="#"&gt;a5&lt;/a&gt; &lt;a href="#"&gt;a6&lt;/a&gt; &lt;/div&gt; &lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"&gt; &lt;/script&gt; &lt;script&gt; let div1 = document.getElementById('div1') div1.addEventListener('click',function (e) &#123; let target = e.target if (target.nodeName === 'A')&#123; alert(target.innerHTML) &#125; &#125;) &lt;/script&gt; &lt;/body&gt; åœºæ™¯2 jQuery $.proxy 1234567891011121314151617181920&lt;body&gt; &lt;div id="div1"&gt; &lt;a href="#"&gt;a1&lt;/a&gt; &lt;a href="#"&gt;a2&lt;/a&gt; &lt;a href="#"&gt;a3&lt;/a&gt; &lt;a href="#"&gt;a4&lt;/a&gt; &lt;a href="#"&gt;a5&lt;/a&gt; &lt;a href="#"&gt;a6&lt;/a&gt; &lt;/div&gt; &lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js" &lt;/script&gt; &lt;script&gt; $('#div1').click(function () &#123; let _this = this setTimeout(function () &#123; $(_this).css('background-color', 'yellow') &#125;,1000) &#125;) &lt;/script&gt;&lt;/body&gt; 123456789101112131415161718192021&lt;body&gt; &lt;div id="div1"&gt; &lt;a href="#"&gt;a1&lt;/a&gt; &lt;a href="#"&gt;a2&lt;/a&gt; &lt;a href="#"&gt;a3&lt;/a&gt; &lt;a href="#"&gt;a4&lt;/a&gt; &lt;a href="#"&gt;a5&lt;/a&gt; &lt;a href="#"&gt;a6&lt;/a&gt; &lt;/div&gt; &lt;script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"&gt; &lt;/script&gt; &lt;script&gt; $('#div1').click(function () &#123; let fn = function () &#123; $(this).css('background-color', 'yellow') &#125; fn = $.proxy(fn, this) setTimeout(fn,1000) &#125;) &lt;/script&gt;&lt;/body&gt; åœºæ™¯3 æ˜Žæ˜Ÿä¸Žç»çºªäºº 1234567891011121314151617181920212223242526272829303132333435// æ˜Žæ˜Ÿlet star = &#123; name: 'å¼ xx', age: 25, phone: 'star: 1390000011111'&#125;//ç»çºªäººlet agent = new Proxy(star,&#123; get: function (target, key) &#123; if (key === 'phone')&#123; return 'agent: 16899997777' &#125; if (key === 'price') &#123; return 120000 &#125; return target[key] &#125;, set: function (target, key, val) &#123; if (key === 'customPrice')&#123; if (val &lt; 100000)&#123; throw new Error('ä»·æ ¼å¤ªä½Ž') &#125;else &#123; target[key] = value return true &#125; &#125; &#125;&#125;)console.log(agent.name)console.log(agent.age)console.log(agent.phone)console.log(agent.price)agent.customPrice = 90000]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è£…é¥°å™¨æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F27%2F%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä¸ºå¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¸æ”¹å˜åŽŸæœ‰çš„ç»“æž„å’ŒåŠŸèƒ½ ç›¸å…³ä»£ç å®žçŽ°1234567891011121314151617181920212223class Circle &#123; draw() &#123; console.log('ç”»ä¸€ä¸ªåœ†') &#125;&#125;class Decorator &#123; constructor(circle)&#123; this.circle = circle &#125; draw() &#123; this.circle.draw() this.setRedBorder(circle) &#125; setRedBorder(cicle)&#123; console.log('è®¾ç½®çº¢è‰²è¾¹æ¡†') &#125;&#125;let circle = new Circle()circle.draw()let decorator = new Decorator(circle)decorator.draw() ä½¿ç”¨åœºæ™¯(es7è£…é¥°å™¨)core-decoratorsç¬¬ä¸‰åº“çš„ä½¿ç”¨ çŽ¯å¢ƒé…ç½® 1234567 npm install @babel/plugin-proposal-decorators --save-dev.babelrcç›¸å…³é…ç½® &#123; &quot;presets&quot;: [&quot;@babel/preset-env&quot;], &quot;plugins&quot;: [[&quot;@babel/plugin-proposal-decorators&quot;,&#123;&quot;legacy&quot;:true&#125;]] &#125; åœºæ™¯1 123456789@testDecclass Demo &#123;&#125;function testDec (target) &#123; target.desc = true&#125;alert(Demo.desc) åœºæ™¯2 1234567891011121314151617181920function mixin (...list) &#123; return function (target) &#123; Object.assign(target.prototype,...list) &#125;&#125;const Foo = &#123; foo()&#123; alert('foo') &#125;&#125;@mixin(Foo)class MyClass &#123;&#125;let tem = new MyClass()tem.foo() åœºæ™¯3 123456789101112131415161718192021function readOnly (target,name,descriptor) &#123; descriptor.writable = false console.log(descriptor) return descriptor&#125;class Person &#123; constructor() &#123; this.first = 'A' this.last = 'B' &#125; @readOnly name() &#123; return `$&#123;this.first&#125; $&#123;this.last&#125;` &#125;&#125;let p = new Person()console.log(p.name())p.name = function () &#123; return 'ä½ å¥½'&#125;console.log(p.name()) åœºæ™¯4 12345678910111213141516function log (target, name, decriptor) &#123; let oldValue = decriptor.value decriptor.value = function () &#123; console.log(`calling $&#123;name&#125; width $&#123;arguments&#125;`) return oldValue.apply(this,arguments) &#125; return decriptor&#125;class Math &#123; @log add(a, b) &#123; return a + b &#125;&#125;let math = new Math()const result = math.add(2,4)]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€‚é…å™¨æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F25%2F%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æ—§æŽ¥å£æ ¼å¼å’Œä½¿ç”¨è€…ä¸å…¼å®¹ï¼Œä¸­é—´åŠ ä¸€ä¸ªé€‚é…è½¬æ¢æŽ¥å£ ç›¸å…³ä»£ç å®žçŽ°1234567891011121314151617class Adaptee &#123; specificRequest() &#123; return 'å¾·å›½æ ‡å‡†æ’å¤´' &#125;&#125;class Target &#123; constructor() &#123; this.adaptee = new Adaptee() &#125; request() &#123; let info = this.adaptee.specificRequest() return `$&#123;info&#125; - è½¬åŒ–å™¨ - ä¸­å›½æ ‡å‡†æ’å¤´` &#125;&#125;let target = new Target()let res = target.request()console.log(res) ä½¿ç”¨åœºæ™¯åœºæ™¯1 æ—§æŽ¥å£å°è£… 1234567891011121314151617æ–°å°è£…çš„æŽ¥å£ajax(&#123; url: '/getData', type: 'Post', dataType: 'json', data: &#123; id: '123' &#125; &#125;).done(function() &#123;&#125;)ä½†å› ä¸ºåŽ†å²åŽŸå› ï¼Œä»£ç ä¸­å…¨éƒ¨éƒ½æ˜¯: $.ajax(&#123;...&#125;)å¯ä»¥åšå¦‚ä¸‹ä¿®æ”¹:åšä¸€å±‚é€‚é…å™¨let $ = &#123; ajax:function (options) &#123; return ajax(options); &#125;&#125;]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç»„åˆæ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F23%2F%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç”Ÿæˆæ ‘å½¢ç»“æž„ï¼Œè¡¨ç¤ºâ€œæ•´ä½“-éƒ¨åˆ†â€å…³ç³»ï¼Œè®©æ•´ä½“å’Œéƒ¨åˆ†éƒ½å…·æœ‰ä¸€è‡´çš„æ“ä½œæ–¹å¼ ç›¸å…³ä»£ç å®žçŽ°12345678910111213141516171819&#123; tag: 'div', attr: &#123; id: 'div1', className: 'container' &#125;, children: [ &#123; tag: 'p', attr: &#123;&#125;, chirldren: ['123'] &#125;, &#123; tag: 'p', attr: &#123;&#125;, chirdren: ['456'] &#125; ] &#125;]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å•ä¾‹æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F23%2F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ç›¸å…³ä»£ç å®žçŽ°12345678910111213141516171819class SingleObject&#123; login() &#123; console.log('login...') &#125;&#125;SingleObject.getInstance = (function () &#123; let instance return function () &#123; if (!instance)&#123; instance = new SingleObject() &#125; return instance &#125;&#125;)()let obj1 = SingleObject.getInstance()obj1.login()let obj2 = SingleObject.getInstance()obj2.login()console.log('obj1 === obj2',obj1 === obj2) åœºæ™¯1 æ¨¡æ‹Ÿç™»å½• 123456789101112131415161718192021222324252627282930313233343536class LoginForm &#123; constructor() &#123; this.state = 'hide' &#125; show() &#123; if (this.state === 'show')&#123; alert('å·²æ˜¾ç¤º') return &#125; this.state = 'show' console.log('ç™»å½•æ¡†æ˜¾ç¤ºæˆåŠŸ') &#125; hide() &#123; if (this.state === 'hide')&#123; alert('å·²éšè—') return &#125; this.state = 'hide' console.log('ç™»å½•æ¡†å·²éšè—') &#125;&#125;LoginForm.getInstance = (function () &#123; let instance return function () &#123; if (!instance)&#123; instance = new LoginForm() &#125; return instance &#125;&#125;)()let login1 = LoginForm.getInstance()login1.show()let login2 = LoginForm.getInstance()login2.show()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F22%2F%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä¸åŒç­–ç•¥åˆ†å¼€å¤„ç†ï¼Œé¿å…å‡ºçŽ°ifâ€¦elseæˆ–è€…switchâ€¦case ä½¿ç”¨ç­–ç•¥æ¨¡å¼å‰ç›¸å…³ä»£ç å®žçŽ° 1234567891011121314151617181920212223class User &#123; constructor (type) &#123; this.type = type &#125; buy() &#123; if (this.type === 'ordinary') &#123; console.log('æ™®é€šç”¨æˆ·è´­ä¹°') &#125;else if(this.type === 'member')&#123; console.log('ä¼šå‘˜ç”¨æˆ·è´­ä¹°') &#125;else if (this.type === 'vip')&#123; console.log('vip ç”¨æˆ·è´­ä¹°') &#125; &#125;&#125;let u1 = new User('ordinary')u1.buy()let u2 = new User('member')u2.buy()let u3 = new User('vip')u3.buy() ä½¿ç”¨ç­–ç•¥æ¨¡å¼ä¹‹åŽç›¸å…³ä»£ç å®žçŽ° 1234567891011121314151617181920212223242526class OrdinaryUser &#123; buy() &#123; console.log('æ™®é€šç”¨æˆ·è´­ä¹°') &#125;&#125;class MemberUser &#123; buy() &#123; console.log('ä¼šå‘˜ç”¨æˆ·è´­ä¹°') &#125;&#125;class VipUser &#123; buy() &#123; console.log('vipç”¨æˆ·è´­ä¹°') &#125;&#125;let u1 = new OrdinaryUser()u1.buy()let u2 = new MemberUser()u2.buy()let u3 = new VipUser()u3.buy()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å·¥åŽ‚æ¨¡å¼]]></title>
    <url>%2F2018%2F06%2F22%2F%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å°†newæ“ä½œå•ç‹¬å°è£…ï¼Œé‡åˆ°newæ—¶ï¼Œå°±è¦è€ƒè™‘æ˜¯å¦ä½¿ç”¨å·¥åŽ‚æ¨¡å¼ ç›¸å…³ä»£ç å®žçŽ°12345678910111213141516171819202122232425class Product &#123; constructor(name) &#123; this.name = name &#125; init() &#123; alert('init') &#125; fun1() &#123; alert('fun1') &#125; fun2() &#123; alert('fun2') &#125;&#125;class Creator &#123; create(name) &#123; return new Product(name) &#125;&#125;let creator = new Creator()let p = creator.create('p1')p.init()p.fun2()]]></content>
      <categories>
        <category>jsä¸­çš„è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoæ­å»ºNextä¸»é¢˜ä½¿ç”¨å°ç»“]]></title>
    <url>%2F2018%2F06%2F21%2FHexoNext%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[è‡ªå·±åœ¨ä½¿ç”¨hexoæ­å»ºåšå®¢çš„æ—¶å€™ç¢°åˆ°äº†ä¸å°‘å‘ï¼Œä¸‹é¢æ¥åšä¸€äº›æ€»ç»“å§! æ³¨: åœ¨ Hexo ä¸­æœ‰ä¸¤ä»½ä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼Œå…¶åç§°éƒ½æ˜¯ _config.ymlã€‚ å…¶ä¸­ï¼Œä¸€ä»½ä½äºŽç«™ç‚¹æ ¹ç›®å½•ä¸‹ï¼Œä¸»è¦åŒ…å« Hexo æœ¬èº«çš„é…ç½®ï¼›å¦ä¸€ä»½ä½äºŽä¸»é¢˜ç›®å½•ä¸‹ï¼Œè¿™ä»½é…ç½®ç”±ä¸»é¢˜ä½œè€…æä¾›ï¼Œä¸»è¦ç”¨äºŽé…ç½®ä¸»é¢˜ç›¸å…³çš„é€‰é¡¹ã€‚ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œåœ¨ä»¥ä¸‹è¯´æ˜Žä¸­ï¼Œå°†å‰è€…ç§°ä¸º ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œ åŽè€…ç§°ä¸º ä¸»é¢˜é…ç½®æ–‡ä»¶ã€‚ 1. å¯åŠ¨åŠéƒ¨ç½²æŒ‡ä»¤æœ¬åœ°æŸ¥çœ‹æ•ˆæžœ12hexo generatehexo server éƒ¨ç½²åˆ°æœåŠ¡å™¨123hexo clean (å¿…é¡»è¦ï¼Œä¸ç„¶æœ‰æ—¶å› ä¸ºç¼“å­˜é—®é¢˜ï¼ŒæœåŠ¡å™¨æ›´æ–°ä¸äº†ä¸»é¢˜)hexo generatehexo d 2. nextä¸»é¢˜é…ç½®åšå®¢ä¸»é¢˜æ ·å¼ä¸»é¢˜é…ç½®æ–‡ä»¶ä¿®æ”¹ scheme: Pisces è®¾ç½®è¯­è¨€ç«™ç‚¹é…ç½®æ–‡ä»¶ä¿®æ”¹ language: zh-Hans è®¾ç½®èœå•æ ä¸»é¢˜é…ç½®æ–‡ä»¶ä¿®æ”¹ 1234567menu: home: / || home tags: /tags/ || tags categories: /categories/ || th archives: /archives/ || archivemenu_icons: enable: true è®¾ç½®èœå•æ æ€»æ˜¯é å·¦æ˜¾ç¤ºä¸»é¢˜é…ç½®æ–‡ä»¶ä¿®æ”¹ 123sidebar: position: left display: always è®¾ç½®å¤´åƒä¸»é¢˜é…ç½®æ–‡ä»¶ä¿®æ”¹ 1avatar: http://example.com/avatar.png è®¾ç½®ä½œè€…æ˜µç§°ç«™ç‚¹é…ç½®æ–‡ä»¶ä¿®æ”¹ author: xxx è®¾ç½®é¦–é¡µåªæ˜¾ç¤ºé¢„è§ˆ(å¡ç‰‡æ•ˆæžœ)ä¸»é¢˜é…ç½®æ–‡ä»¶ä¿®æ”¹ 123auto_excerpt: enable: true length: 150 æ·»åŠ ç«™ç‚¹æœç´¢åŠŸèƒ½ç¬¬ä¸€æ­¥ ç«™ç‚¹æ ¹ç›®å½•å®‰è£… hexo-generator-searchdb 1npm install hexo-generator-searchdb --save ç¬¬äºŒæ­¥ ç«™ç‚¹é…ç½®æ–‡ä»¶ æ·»åŠ searchå­—æ®µå…·ä½“å¦‚ä¸‹ 12345search: path: search.xml field: post format: html limit: 10000 ç¬¬ä¸‰æ­¥ ä¸»é¢˜é…ç½®æ–‡ä»¶ ä¿®æ”¹ 12local_search: enable: true æ·»åŠ æ ‡ç­¾é¡µé¢ç¬¬ä¸€æ­¥ åœ¨ç»ˆç«¯çª—å£ä¸‹ï¼Œå®šä½åˆ° Hexo ç«™ç‚¹ç›®å½•ä¸‹ã€‚ä½¿ç”¨ hexo new page æ–°å»ºä¸€ä¸ªé¡µé¢ï¼Œå‘½åä¸º tags 12$ cd your-hexo-site$ hexo new page tags ç¬¬äºŒæ­¥ .mdçš„é¡µé¢å†…å®¹è®¾ç½®å¦‚ä¸‹ 123title: jsè®¾è®¡æ¨¡å¼date: 2014-12-22 12:39:04type: &quot;tags&quot;(å¿…å¡«) ç¬¬ä¸‰æ­¥ ä¿®æ”¹èœå• åœ¨èœå•ä¸­æ·»åŠ é“¾æŽ¥ï¼Œç¼–è¾‘ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ  tags åˆ° menu ä¸­ï¼Œå¦‚ä¸‹: 1234menu: home: / archives: /archives tags: /tags (å¿…å¡«) æ·»åŠ åˆ†ç±»é¡µé¢ç¬¬ä¸€æ­¥ åœ¨ç»ˆç«¯çª—å£ä¸‹ï¼Œå®šä½åˆ° Hexo ç«™ç‚¹ç›®å½•ä¸‹ã€‚ä½¿ç”¨ hexo new page æ–°å»ºä¸€ä¸ªé¡µé¢ï¼Œå‘½åä¸º categories 12cd your-hexo-sitehexo new page categories ç¬¬äºŒæ­¥ ç¼–è¾‘åˆšæ–°å»ºçš„é¡µé¢ï¼Œå°†é¡µé¢çš„ type è®¾ç½®ä¸º categories ï¼Œä¸»é¢˜å°†è‡ªåŠ¨ä¸ºè¿™ä¸ªé¡µé¢æ˜¾ç¤ºåˆ†ç±»ã€‚é¡µé¢å†…å®¹å¦‚ä¸‹ï¼š 1234title: åˆ†ç±»date: 2014-12-22 12:39:04type: &quot;categories&quot; (å¿…å¡«)--- ç¬¬ä¸‰æ­¥ åœ¨èœå•ä¸­æ·»åŠ é“¾æŽ¥ã€‚ç¼–è¾‘ä¸»é¢˜é…ç½®æ–‡ä»¶,æ·»åŠ  categories åˆ° menu ä¸­ï¼Œå¦‚ä¸‹: 1234menu: home: / archives: /archives categories: /categories (å¿…å¡«)]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
</search>
